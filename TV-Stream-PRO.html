<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=1" />
    <meta name="theme-color" content="#667eea" />
    <meta name="description" content="TV Stream PRO - Ultimate Streaming Experience" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="TV Stream PRO" />
    <meta name="ppck-ver" content="mobile-ui-update-v3-20241224" />

    <meta name="build-timestamp" content="20241224-mobile-update" />
    <meta name="cache-version" content="v3" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>
        TV Stream PRO - Ultimate Streaming Experience (Mobile Optimized)
    </title>
    <link rel="manifest" href="./manifest.json" />
    <link rel="stylesheet" href="https://vjs.zencdn.net/8.6.1/video-js.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');

        /* MODERN UI - PROFESSIONAL DESIGN */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00D9FF;
            --secondary: #7B2FFF;
            --accent: #FF2E97;
            --dark: #0A0E27;
            --darker: #060918;
            --muted: rgba(255, 255, 255, 0.6);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --soft: rgba(255, 255, 255, 0.03);
            --danger: #FF3366;
            --success: #00FF88;
            --gradient: linear-gradient(135deg, #00D9FF 0%, #7B2FFF 50%, #FF2E97 100%);
        }

        html {
            font-size: 16px;
        }

        /* Mobile-first responsive base */
        @media (max-width: 480px) {
            html {
                font-size: 14px;
            }
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            background: var(--darker);
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: 40px;
            position: relative;
        }

        /* Animated gradient background */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(circle at 20% 20%, rgba(0, 217, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(123, 47, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 46, 151, 0.1) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes gradientShift {

            0%,
            100% {
                opacity: 0.5;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.1);
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient);
            border-radius: 20px;
        }

        .section {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto 60px;
            padding: 0 24px;
        }

        @media (max-width: 768px) {
            .section {
                padding: 0 16px;
                margin: 0 auto 40px;
            }
        }

        @media (max-width: 480px) {
            .section {
                padding: 0 12px;
                margin: 0 auto 30px;
            }
        }

        .section-header-grid {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .section-header-grid {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                margin-bottom: 20px;
            }
        }

        .section-eyebrow {
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 4px;
            color: var(--muted);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .section-title {
            font-size: clamp(28px, 3.5vw, 40px);
            font-weight: 800;
            margin: 6px 0;
        }

        .section-subtitle {
            max-width: 520px;
            color: var(--muted);
            font-size: 16px;
            line-height: 1.5;
        }

        [data-animate] {
            opacity: 0;
            transform: translateY(32px) scale(0.98);
            animation: riseIn 0.9s cubic-bezier(0.16, 0.84, 0.44, 1) forwards;
            animation-delay: var(--delay, 0s);
        }

        @keyframes riseIn {
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes floatPulse {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        .background-grid {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.02) 1px,
                    transparent 1px),
                linear-gradient(90deg,
                    rgba(255, 255, 255, 0.02) 1px,
                    transparent 1px);
            background-size: 80px 80px;
            pointer-events: none;
            opacity: 0.6;
            z-index: 0;
        }

        .background-glow {
            position: fixed;
            width: 520px;
            height: 520px;
            border-radius: 50%;
            filter: blur(90px);
            opacity: 0.4;
            z-index: 0;
            pointer-events: none;
        }

        .background-glow.glow-1 {
            background: #667eea;
            top: -120px;
            right: -80px;
        }

        .background-glow.glow-2 {
            background: #f093fb;
            bottom: -160px;
            left: -60px;
        }

        .app-shell {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 24px 80px;
        }

        .glass-panel {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 28px;
            backdrop-filter: blur(25px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.35);
        }

        .meta-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.85);
            font-size: 13px;
        }

        .floating-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.09);
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-size: 12px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .feature-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
        }

        .feature-matrix .feature-card {
            padding: 18px;
            border-radius: 22px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: rgba(255, 255, 255, 0.03);
        }

        /* Header with Search */
        .header {
            position: sticky;
            top: 0;
            z-index: 10000;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 0;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.15);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg,
                    var(--primary) 0%,
                    var(--secondary) 50%,
                    var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img.site-logo {
            width: 44px;
            height: 44px;
            object-fit: cover;
            border-radius: 8px;
            display: block;
        }

        .logo .logo-text {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Compact header menu to prevent overcrowding */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .compact-menu {
            position: relative;
        }

        .compact-menu-panel {
            position: absolute;
            right: 0;
            top: calc(100% + 8px);
            min-width: 180px;
            background: rgba(10, 10, 10, 0.98);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            box-shadow: 0 12px 36px rgba(0, 0, 0, 0.6);
            padding: 8px;
            display: none;
            flex-direction: column;
            z-index: 10002;
        }

        .compact-menu-panel.active {
            display: flex;
        }

        .compact-link {
            padding: 8px 12px;
            color: #fff;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
        }

        .compact-link:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        /* Hide-on-scroll helpers */
        .hidden-by-scroll {
            transform: translateY(-120%);
            opacity: 0 !important;
            pointer-events: none;
        }

        .search-container,
        .header-actions,
        .logo .logo-text,
        .logo-subtitle {
            transition: transform 280ms cubic-bezier(.2, .9, .2, 1), opacity 220ms ease;
        }

        /* Make entire header hideable with a smooth transition */
        .header {
            transition: transform 320ms cubic-bezier(.2, .9, .2, 1), opacity 220ms ease;
            will-change: transform, opacity;
        }

        .logo-subtitle {
            font-size: 12px;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--muted);
        }

        /* Moving app description (marquee style) */
        .app-marquee {
            width: 100%;
            background: linear-gradient(90deg,
                    rgba(102, 126, 234, 0.2),
                    rgba(118, 75, 162, 0.2));
            border-bottom: 1px solid var(--glass-border);
            overflow: hidden;
            white-space: nowrap;
        }

        .app-marquee-inner {
            display: inline-block;
            padding: 8px 0;
            animation: marquee-move 28s linear infinite;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
        }

        .app-marquee-inner span {
            margin-right: 60px;
        }

        @keyframes marquee-move {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(-100%);
            }
        }

        .search-container {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-box {
            width: 100%;
            padding: 12px 50px 12px 20px;
            background: var(--glass);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            color: #fff;
            font-size: 15px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
            background: rgba(255, 255, 255, 0.08);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--glass);
            border: 2px solid var(--glass-border);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .icon-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: var(--gradient);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .icon-btn i {
            position: relative;
            z-index: 1;
        }

        .icon-btn:hover {
            border-color: transparent;
            transform: scale(1.15);
            box-shadow: 0 8px 24px rgba(0, 217, 255, 0.5);
        }

        .icon-btn:hover::before {
            opacity: 1;
        }

        .icon-btn.active {
            background: var(--gradient);
            border-color: transparent;
            box-shadow: 0 8px 24px rgba(0, 217, 255, 0.5);
        }

        .icon-btn.active::before {
            opacity: 1;
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ef4444;
            color: #fff;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            border: 2px solid var(--dark);
        }

        .notifications-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 380px;
            max-width: calc(100vw - 40px);
            max-height: calc(100vh - 120px);
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(30px) saturate(180%);
            z-index: 10001;
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: slideDown 0.3s ease;
        }

        .notifications-panel.active {
            display: flex;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notifications-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-header h3 {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .notifications-body {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .notification-item-user {
            padding: 14px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .notification-item-user:hover {
            background: rgba(30, 64, 175, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateX(4px);
        }

        .notification-item-user.unread {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.4);
        }

        .notification-title-user {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 6px;
            color: rgba(249, 250, 251, 0.95);
        }

        .notification-message-user {
            font-size: 13px;
            color: rgba(148, 163, 184, 0.9);
            line-height: 1.5;
            margin-bottom: 6px;
        }

        .notification-meta-user {
            font-size: 11px;
            color: rgba(148, 163, 184, 0.7);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-type-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .notification-type-badge.info {
            background: rgba(59, 130, 246, 0.2);
            color: rgba(147, 197, 253, 1);
        }

        .notification-type-badge.success {
            background: rgba(34, 197, 94, 0.2);
            color: rgba(134, 239, 172, 1);
        }

        .notification-type-badge.warning {
            background: rgba(234, 179, 8, 0.2);
            color: rgba(253, 224, 71, 1);
        }

        .notification-type-badge.error {
            background: rgba(239, 68, 68, 0.2);
            color: rgba(254, 202, 202, 1);
        }

        .notifications-empty {
            padding: 40px 20px;
            text-align: center;
            color: rgba(148, 163, 184, 0.8);
            font-size: 14px;
        }

        /* Immersive Hero */
        .hero-section {
            width: 100%;
            padding: 40px 0 20px;
        }

        .hero-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 40px;
            align-items: start;
        }

        @media (max-width: 768px) {
            .hero-grid {
                grid-template-columns: 1fr;
                gap: 24px;
            }
        }

        @media (max-width: 480px) {
            .hero-grid {
                gap: 16px;
            }
        }

        .hero-gallery {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 18px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .hero-gallery {
                grid-template-columns: repeat(auto-fill,
                        minmax(180px, 1fr));
                gap: 12px;
                margin-bottom: 15px;
            }
        }

        @media (max-width: 480px) {
            .hero-gallery {
                grid-template-columns: repeat(auto-fill,
                        minmax(140px, 1fr));
                gap: 10px;
            }
        }

        .hero-gallery .gallery-card {
            border-radius: 22px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            gap: 8px;
            cursor: pointer;
            transition:
                transform 0.3s ease,
                border-color 0.3s ease;
        }

        .hero-gallery .gallery-card:hover {
            transform: translateY(-6px);
            border-color: var(--primary);
        }

        .hero-gallery .gallery-card strong {
            font-size: 16px;
        }

        .hero-gallery .gallery-card.active {
            border-color: var(--accent);
            box-shadow: 0 15px 35px rgba(53, 255, 210, 0.25);
        }

        .hero-gallery .gallery-card small {
            color: var(--muted);
        }

        /* Quick Actions */
        .quick-actions {
            margin-top: 30px;
        }

        .quick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 18px;
        }

        .quick-card {
            border: none;
            border-radius: 24px;
            padding: 18px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(18px);
            color: #fff;
            font-weight: 600;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 6px;
            cursor: pointer;
            transition:
                transform 0.25s ease,
                border-color 0.25s ease;
        }

        .quick-card i {
            font-size: 22px;
            color: var(--accent);
        }

        .quick-card small {
            font-weight: 400;
            color: var(--muted);
        }

        .quick-card:hover {
            transform: translateY(-6px);
            border-color: var(--primary);
        }

        .hero-media {
            position: relative;
            min-height: 460px;
            border-radius: 32px;
            overflow: hidden;
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.45);
        }

        .hero-slider {
            position: absolute;
            inset: 0;
        }

        .hero-slider::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: var(--hero-image,
                    url("https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=1400&q=80"));
            background-size: cover;
            background-position: center;
            filter: saturate(1.2);
            transition:
                transform 1s ease,
                background-image 0.6s ease;
            transform: scale(1.08);
        }

        .hero-slider::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg,
                    rgba(5, 5, 5, 0.05) 0%,
                    rgba(5, 5, 5, 0.8) 100%);
        }

        .hero-progress {
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 2;
        }

        .hero-progress-dot {
            width: 48px;
            height: 4px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.25);
            transition: all 0.3s ease;
        }

        .hero-progress-dot.active {
            background: linear-gradient(135deg,
                    var(--primary),
                    var(--accent));
            box-shadow: 0 0 18px rgba(102, 126, 234, 0.8);
        }

        .hero-strip {
            position: absolute;
            bottom: 18px;
            left: 18px;
            right: 18px;
            display: flex;
            gap: 14px;
            overflow-x: auto;
            padding-bottom: 6px;
            scrollbar-width: none;
            z-index: 2;
        }

        .hero-strip::-webkit-scrollbar {
            display: none;
        }

        .hero-thumb {
            min-width: 140px;
            border-radius: 18px;
            border: 1px solid transparent;
            background: rgba(5, 5, 5, 0.6);
            color: #fff;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font: inherit;
            text-align: left;
            outline: none;
        }

        .hero-thumb img {
            width: 100%;
            height: 90px;
            border-radius: 14px;
            object-fit: cover;
        }

        .hero-thumb span {
            font-size: 12px;
            font-weight: 600;
            line-height: 1.3;
        }

        .hero-thumb.active {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.2);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.25);
        }

        .hero-thumb:focus-visible {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(240, 147, 251, 0.35);
        }

        .carousel-controls {
            position: absolute;
            inset: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 2;
            pointer-events: none;
        }

        .carousel-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            pointer-events: auto;
        }

        .carousel-btn:hover {
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .hero-details {
            background: rgba(0, 0, 0, 0.45);
            border-radius: 32px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 40px;
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 55px rgba(0, 0, 0, 0.45);
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 18px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hero-title {
            font-size: clamp(30px, 3.5vw, 48px);
            font-weight: 800;
            margin: 20px 0 10px;
            line-height: 1.1;
        }

        .hero-description {
            font-size: 18px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 25px;
        }

        .hero-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .hero-meta span {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }

        .hero-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .action-btn {
            padding: 16px 36px;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: "Poppins", sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg,
                    var(--primary) 0%,
                    var(--secondary) 100%);
            color: #ffffff;
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.35);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 45px rgba(102, 126, 234, 0.45);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary);
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-card {
            padding: 16px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-card span {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.6);
        }

        .stat-card strong {
            font-size: 28px;
            line-height: 1;
        }

        /* Categories Enhanced */
        .categories-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 40px 20px;
            flex-wrap: wrap;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
        }

        .category-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 28px;
            background: var(--glass);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .category-btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                    transparent,
                    rgba(255, 255, 255, 0.2),
                    transparent);
            transition: left 0.5s;
        }

        .category-btn:hover::before {
            left: 100%;
        }

        .category-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .category-btn.active {
            background: linear-gradient(135deg,
                    var(--primary) 0%,
                    var(--secondary) 100%);
            border-color: var(--primary);
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.5);
        }

        /* Content Grid Enhanced */
        .category-section {
            padding: 50px 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            padding: 0 10px;
        }

        .category-title {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg,
                    #ffffff 0%,
                    var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--glass);
            border: 2px solid var(--glass-border);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            padding: 0 10px;
        }

        .content-grid.list-view {
            grid-template-columns: 1fr;
        }

        .content-card {
            background: var(--glass);
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid var(--glass-border);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .content-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg,
                    var(--primary),
                    var(--secondary));
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .content-card:hover::before {
            opacity: 0.1;
        }

        .content-card:hover {
            transform: translateY(-15px) scale(1.03);
            border-color: var(--primary);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
        }

        .card-image-wrapper {
            position: relative;
            width: 100%;
            padding-top: 150%;
            overflow: hidden;
        }

        .card-image-wrapper img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .content-card:hover .card-image-wrapper img {
            transform: scale(1.15);
        }

        .card-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
            backdrop-filter: blur(10px);
        }

        .card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top,
                    rgba(0, 0, 0, 0.9) 0%,
                    transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 2;
        }

        .content-card:hover .card-overlay {
            opacity: 1;
        }

        .play-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg,
                    var(--primary) 0%,
                    var(--secondary) 100%);
            border: none;
            color: #ffffff;
            font-size: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.6);
            transition: all 0.3s ease;
        }

        .play-button:hover {
            transform: scale(1.15);
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.8);
        }

        .card-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 3;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .content-card:hover .card-actions {
            opacity: 1;
        }

        .card-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .card-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .card-action-btn.favorited {
            color: #ff6b6b;
            border-color: #ff6b6b;
        }

        .card-info {
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .card-meta {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Modal Enhanced */
        .modal-overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(20px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            position: relative;
            width: min(920px, 95vw);
            background: rgba(5, 5, 8, 0.98);
            border-radius: 32px;
            overflow: hidden;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.85);
            animation: modalSlideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.08);
            display: grid;
            grid-template-columns: minmax(0, 3fr) minmax(260px, 2fr);
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            grid-column: span 2;
            padding: 20px 28px;
            background: rgba(255, 255, 255, 0.02);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: rgba(255, 255, 255, 0.7);
        }

        .modal-close {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: rotate(90deg) scale(1.05);
        }

        .modal-video {
            width: 100%;
            min-height: 280px;
            position: relative;
            background: #000;
        }

        .modal-main {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .modal-video::after {
            content: "";
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: linear-gradient(180deg,
                    rgba(0, 0, 0, 0) 50%,
                    rgba(0, 0, 0, 0.4) 100%);
        }

        .modal-video video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }

        .player-status {
            position: absolute;
            bottom: 16px;
            left: 16px;
            padding: 8px 16px;
            border-radius: 999px;
            background: rgba(0, 0, 0, 0.65);
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            letter-spacing: 0.4px;
            backdrop-filter: blur(6px);
            transition: opacity 0.25s ease;
            opacity: 0;
            pointer-events: none;
        }

        .player-status.active {
            opacity: 1;
        }

        .video-controls {
            padding: 18px 24px;
            background: rgba(0, 0, 0, 0.45);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .modal-side {
            padding: 26px;
            display: flex;
            flex-direction: column;
            gap: 18px;
            background: rgba(255, 255, 255, 0.01);
        }

        .modal-meta h3 {
            font-size: 28px;
            margin: 8px 0 6px;
        }

        .modal-meta p {
            color: var(--muted);
            line-height: 1.5;
        }

        .meta-chipset {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 12px;
        }

        .modal-shortcuts {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal-shortcuts button {
            border: none;
            border-radius: 16px;
            padding: 14px 18px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition:
                transform 0.2s ease,
                background 0.2s ease;
        }

        .modal-shortcuts button.primary {
            background: linear-gradient(135deg,
                    var(--primary),
                    var(--secondary));
        }

        .modal-shortcuts button.secondary {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-shortcuts button:hover {
            transform: translateY(-2px);
        }

        .modal-tip {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            gap: 8px;
            align-items: flex-start;
        }

        #aboutTicker {
            transition: opacity 0.3s ease;
        }

        .data-saver-banner {
            grid-column: span 2;
        }

        @media (max-width: 820px) {
            .modal-content {
                grid-template-columns: 1fr;
            }

            .modal-side {
                border-top: 1px solid rgba(255, 255, 255, 0.06);
            }
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .control-select {
            padding: 8px 15px;
            background: var(--glass);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-range {
            -webkit-appearance: none;
            appearance: none;
            width: 140px;
            height: 4px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.15);
            outline: none;
        }

        .control-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.4);
        }

        .control-range::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.4);
        }

        .control-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Search Results */
        .search-results {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px 20px;
            display: none;
        }

        .search-results.active {
            display: block;
        }

        .results-header {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(135deg,
                    #ffffff 0%,
                    var(--primary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Loading Spinner */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .loading.active {
            display: block;
            opacity: 1;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
                padding: 0 15px;
            }

            .search-container {
                order: 3;
                width: 100%;
                margin-top: 10px;
            }

            .slide-title {
                font-size: 32px;
            }

            .slide-description {
                font-size: 16px;
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill,
                        minmax(150px, 1fr));
                gap: 15px;
            }

            .category-title {
                font-size: 28px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--darker);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }

        /* Theme Variations */
        body[data-theme="light"] {
            background: #f4f4f8;
            color: #0f172a;
        }

        body[data-theme="light"] .header {
            background: rgba(255, 255, 255, 0.92);
            border-bottom-color: rgba(99, 102, 241, 0.2);
        }

        body[data-theme="light"] .content-card,
        body[data-theme="light"] .modal-content {
            background: rgba(255, 255, 255, 0.85);
            color: #0f172a;
        }

        body.reduce-motion * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
            scroll-behavior: auto !important;
        }

        body.data-saver video {
            filter: contrast(0.9) brightness(0.9);
        }

        /* Header Enhancements */
        .header-content {
            flex-wrap: wrap;
        }

        .header-quick-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.04);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
        }

        .quick-link:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.35);
        }

        .user-area {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .user-pill {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 18px;
            border-radius: 999px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.04);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-pill:hover {
            border-color: var(--primary);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.35);
        }

        .user-avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: linear-gradient(135deg,
                    var(--primary),
                    var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .user-meta {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
            text-align: left;
        }

        .user-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .user-menu {
            position: absolute;
            top: calc(100% + 12px);
            right: 0;
            min-width: 220px;
            padding: 16px;
            border-radius: 20px;
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
            backdrop-filter: blur(20px);
            opacity: 0;
            pointer-events: none;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 10001;
        }

        .user-menu.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }

        .user-menu button,
        .user-menu a {
            width: 100%;
            padding: 10px 14px;
            border-radius: 12px;
            background: transparent;
            border: none;
            color: inherit;
            font-family: inherit;
            font-weight: 500;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
            text-decoration: none;
        }

        .user-menu button:hover,
        .user-menu a:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        /* Settings Panel */
        .settings-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 9998;
        }

        .settings-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .settings-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: min(420px, 90%);
            height: 100vh;
            background: rgba(10, 10, 10, 0.97);
            backdrop-filter: blur(25px);
            border-left: 1px solid var(--glass-border);
            box-shadow: -30px 0 60px rgba(0, 0, 0, 0.6);
            transform: translateX(100%);
            transition: transform 0.4s ease;
            z-index: 9999;
            display: flex;
            flex-direction: column;
        }

        .settings-panel.active {
            transform: translateX(0);
        }

        .settings-header,
        .settings-footer {
            padding: 24px;
            border-bottom: 1px solid var(--glass-border);
        }

        .settings-footer {
            border-top: 1px solid var(--glass-border);
            border-bottom: none;
            display: flex;
            gap: 12px;
        }

        .settings-body {
            padding: 0 24px 24px;
            overflow-y: auto;
        }

        .settings-group {
            margin-top: 24px;
            padding: 20px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
        }

        .settings-group h4 {
            margin-bottom: 18px;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: rgba(255, 255, 255, 0.6);
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-text {
            flex: 1;
        }

        .settings-text h5 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .settings-text p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
        }

        .switch {
            position: relative;
            width: 52px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 999px;
            transition: background 0.3s ease;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            top: 3px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .switch input:checked+.slider {
            background: linear-gradient(135deg,
                    var(--primary),
                    var(--secondary));
        }

        .switch input:checked+.slider:before {
            transform: translateX(24px);
        }

        .settings-select {
            width: 160px;
            padding: 10px 12px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05);
            color: inherit;
            font-family: inherit;
        }

        .settings-footer button {
            flex: 1;
            padding: 14px;
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            background: transparent;
            color: inherit;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-footer button.primary {
            background: linear-gradient(135deg,
                    var(--primary),
                    var(--secondary));
            border: none;
        }

        .settings-footer button:hover {
            opacity: 0.9;
        }

        .settings-status {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 10px;
        }

        /* Data Saver Banner */
        .data-saver-banner {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            border-radius: 12px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.4);
            color: #a7f3d0;
            margin-bottom: 12px;
            font-size: 13px;
        }

        .data-saver-banner.active {
            display: flex;
        }

        .app-toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 14px 22px;
            border-radius: 16px;
            background: rgba(10, 10, 10, 0.85);
            border: 1px solid var(--glass-border);
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.45);
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 10050;
            font-weight: 500;
        }

        .app-toast.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* About Section */
        .about-section {
            padding: 90px 30px 140px;
            position: relative;
            overflow: hidden;
        }

        .about-section::before,
        .about-section::after {
            content: "";
            position: absolute;
            width: 320px;
            height: 320px;
            border-radius: 50%;
            background: radial-gradient(circle,
                    rgba(102, 126, 234, 0.25),
                    transparent 70%);
            filter: blur(60px);
            animation: float 12s ease-in-out infinite alternate;
        }

        .about-section::before {
            top: -120px;
            left: -100px;
        }

        .about-section::after {
            bottom: -160px;
            right: -120px;
            animation-delay: 2.5s;
        }

        .about-headline {
            max-width: 900px;
            margin: 0 auto 50px;
            text-align: center;
        }

        .about-swap {
            margin-top: 18px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 14px;
            color: rgba(255, 255, 255, 0.75);
        }

        .about-swap span:last-child {
            font-weight: 600;
            color: #ffffff;
        }

        .eyebrow {
            text-transform: uppercase;
            letter-spacing: 4px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 12px;
        }

        .about-headline h2 {
            font-size: 46px;
            margin-bottom: 18px;
            background: linear-gradient(135deg, #fff, var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .about-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
        }

        .about-card {
            padding: 24px;
            border-radius: 24px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            animation: fadeUp 0.8s ease forwards;
            opacity: 0;
        }

        .about-card:nth-child(2) {
            animation-delay: 0.1s;
        }

        .about-card:nth-child(3) {
            animation-delay: 0.2s;
        }

        .about-card:nth-child(4) {
            animation-delay: 0.3s;
        }

        .about-card i {
            font-size: 26px;
            margin-bottom: 16px;
            color: var(--accent);
        }

        .about-card h3 {
            margin-bottom: 10px;
        }

        .about-timeline {
            margin-top: 60px;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .timeline-item {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .timeline-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: linear-gradient(135deg,
                    var(--primary),
                    var(--accent));
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.9);
        }

        .timeline-card {
            flex: 1;
            padding: 18px 22px;
            border-radius: 18px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.03);
        }

        @keyframes float {
            to {
                transform: translateY(-15px);
            }
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(25px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Comprehensive Mobile Responsive Design */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: repeat(auto-fill,
                        minmax(200px, 1fr));
            }
        }

        @media (max-width: 1024px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill,
                        minmax(180px, 1fr));
            }

            .quick-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .header-quick-links {
                width: 100%;
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .header-quick-links::-webkit-scrollbar {
                display: none;
            }

            .user-pill {
                width: 100%;
                justify-content: space-between;
            }

            .settings-panel {
                width: 100%;
                max-width: none;
                left: 0;
                right: 0;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill,
                        minmax(160px, 1fr));
                gap: 12px;
            }

            .quick-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 12px;
            }

            .video-modal .modal-content {
                width: 95%;
                max-width: none;
                margin: 20px auto;
            }

            .about-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .social-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        @media (max-width: 640px) {
            .section-title {
                font-size: clamp(24px, 5vw, 32px);
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill,
                        minmax(140px, 1fr));
                gap: 10px;
            }

            .quick-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .quick-card {
                padding: 16px 12px;
                min-height: 80px;
            }

            .quick-card i {
                font-size: 20px;
            }

            .quick-card strong {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .hero-media {
                min-height: 280px;
            }

            .content-grid {
                grid-template-columns: repeat(auto-fill,
                        minmax(120px, 1fr));
                gap: 8px;
            }

            .content-card {
                border-radius: 12px;
            }

            .content-card-overlay {
                padding: 8px;
            }

            .content-card-title {
                font-size: 12px;
            }

            .quick-grid {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .quick-card {
                padding: 12px 8px;
                min-height: 70px;
            }

            .search-input {
                padding: 12px 16px;
                font-size: 14px;
            }

            .view-toggle {
                flex-wrap: wrap;
                gap: 8px;
            }

            .category-filter {
                padding: 8px 12px;
                font-size: 13px;
            }

            .video-modal .modal-content {
                width: 98%;
                margin: 10px auto;
            }

            .video-modal .modal-header {
                padding: 15px;
            }

            .modal-title {
                font-size: 16px;
            }

            .about-card {
                padding: 16px;
            }

            .timeline-card {
                padding: 12px 16px;
            }
        }

        @media (max-width: 360px) {
            .content-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }

            .quick-grid {
                grid-template-columns: 1fr;
            }

            .section-title {
                font-size: 20px;
            }

            .hero-media {
                min-height: 220px;
            }
        }

        /* Touch improvements for mobile */
        @media (hover: none) and (pointer: coarse) {
            .content-card:hover {
                transform: none;
            }

            .content-card:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }

            .quick-card:hover {
                transform: none;
            }

            .quick-card:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }

            .btn:hover {
                transform: none;
            }

            .btn:active {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }
        }

        /* Improve touch targets */
        @media (max-width: 768px) {

            .category-filter,
            .view-btn,
            .quick-link {
                min-height: 44px;
                min-width: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .content-card {
                cursor: pointer;
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            }
        }

        /* Bottom Scrolling Marquee */
        .bottom-marquee {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg,
                    rgba(102, 126, 234, 0.25),
                    rgba(118, 75, 162, 0.25));
            border-top: 1px solid var(--glass-border);
            overflow: hidden;
            white-space: nowrap;
            z-index: 1000;
            height: 40px;
            display: flex;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .bottom-marquee-inner {
            display: inline-block;
            padding: 0;
            animation: bottom-marquee-move 45s linear infinite;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .bottom-marquee-inner span {
            margin-right: 80px;
            display: inline-block;
        }

        @keyframes bottom-marquee-move {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(-100%);
            }
        }

        /* Social Hub */
        .social-section {
            max-width: 1600px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .social-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .social-card {
            border-radius: 24px;
            padding: 22px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(14px);
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition:
                transform 0.3s ease,
                border-color 0.3s ease;
        }

        .social-card:hover {
            transform: translateY(-6px);
            border-color: var(--primary);
        }

        .social-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .social-card a {
            color: rgba(255, 255, 255, 0.85);
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
        }

        .social-card small {
            color: rgba(255, 255, 255, 0.55);
        }

        @media (max-width: 768px) {
            .score {
                font-size: 28px;
            }
        }

        /* Sports IPTV Playlist */
        .sports-section {
            margin-top: 40px;
        }

        .sports-layout {
            display: grid;
            grid-template-columns: minmax(0, 1.3fr) minmax(0, 0.9fr);
            gap: 24px;
            padding: 24px;
            border-radius: 32px;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(18px);
        }

        .sports-player-panel {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .sports-player-shell {
            position: relative;
            border-radius: 24px;
            overflow: hidden;
            background: #000;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        #sportsPlayer {
            width: 100%;
            height: 100%;
            min-height: 260px;
            border: none;
            background: #000;
        }

        .sports-player-status {
            position: absolute;
            left: 16px;
            bottom: 16px;
            padding: 10px 16px;
            border-radius: 999px;
            background: rgba(0, 0, 0, 0.55);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #fff;
            pointer-events: none;
        }

        .sports-browser {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .sports-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .sports-tab {
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border-radius: 999px;
            padding: 10px 18px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sports-tab small {
            font-size: 12px;
            color: var(--muted);
        }

        .sports-tab.active {
            background: linear-gradient(120deg,
                    var(--primary),
                    var(--secondary));
            border-color: transparent;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.35);
        }

        .sports-channel-list {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 22px;
            padding: 8px;
            max-height: 420px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .channel-item {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding: 10px 14px;
            border-radius: 16px;
            border: 1px solid transparent;
            background: transparent;
            color: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .channel-item:hover {
            border-color: rgba(255, 255, 255, 0.18);
            background: rgba(255, 255, 255, 0.05);
        }

        .channel-item.active {
            border-color: var(--accent);
            background: rgba(53, 255, 210, 0.14);
        }

        .channel-item img,
        .channel-placeholder-logo {
            width: 46px;
            height: 46px;
            border-radius: 14px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 18px;
        }

        .channel-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
            text-align: left;
        }

        .channel-info strong {
            font-size: 15px;
        }

        .channel-info span {
            font-size: 12px;
            color: var(--muted);
        }

        .channel-placeholder,
        .channel-error {
            padding: 24px;
            text-align: center;
            color: var(--muted);
        }

        @media (max-width: 1024px) {
            .sports-layout {
                grid-template-columns: 1fr;
            }

            #sportsPlayer {
                min-height: 220px;
            }

            .sports-channel-list {
                max-height: 320px;
            }
        }
    </style>
</head>

<body>
    <div class="background-grid" aria-hidden="true"></div>
    <div class="background-glow glow-1" aria-hidden="true"></div>
    <div class="background-glow glow-2" aria-hidden="true"></div>
    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header class="header" data-animate>
        <div class="header-content">
            <div>
                <h1 class="logo">
                    <img src="assets/tvstream-logo.png" alt="TV Stream" class="site-logo" />
                    <span class="logo-text">TV Stream PRO</span>
                </h1>
                <p class="logo-subtitle">Realtime  Fluid  Personalized</p>
            </div>
            <div class="search-container">
                <input type="text" class="search-box" id="searchBox" placeholder="Search movies, series, music..." />
                <i class="fas fa-search search-icon"></i>
            </div>
            <div class="header-quick-links">
                <a class="quick-link" href="./TV-Stream-PRO.html">
                    <i class="fas fa-house"></i>
                    <span>Home</span>
                </a>
                <a class="quick-link" href="./TV-Stream-PRO.html#live-tv">
                    <i class="fas fa-satellite-dish"></i>
                    <span>Live TV</span>
                </a>
                <a class="quick-link" href="./TV-Stream-PRO.html#movies">
                    <i class="fas fa-film"></i>
                    <span>Movies</span>
                </a>
                <a class="quick-link" href="./TV-Stream-PRO.html#sports">
                    <i class="fas fa-football"></i>
                    <span>Sports</span>
                </a>
                <a class="quick-link" id="aiPredictionsLink" href="./football-ai.html">
                    <i class="fas fa-robot"></i>
                    <span>AI Predictions</span>
                </a>
                <!-- Boost TZ removed -->
                <!-- Admin link removed per request -->
            </div>
            <div class="header-actions">
                <div class="icon-btn" id="notificationsBtn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge" style="display: none">0</span>
                </div>
                <div class="icon-btn" id="favoritesBtn" title="Favorites">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="icon-btn" id="settingsBtn" title="Settings">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="user-area">
                    <button class="user-pill" id="userMenuToggle" type="button">
                        <div class="user-avatar" id="userAvatarInitial">
                            TS
                        </div>
                        <div class="user-meta">
                            <span class="user-label" id="userGreeting">Karibu</span>
                            <strong id="userNameLabel">Mgeni</strong>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-menu" id="userMenu">
                        <button type="button" id="openSettingsFromMenu">
                            <i class="fas fa-sliders-h"></i>
                            <span>Personalize App</span>
                        </button>
                        <button type="button" id="logoutBtn">
                            <i class="fas fa-arrow-right-from-bracket"></i>
                            <span>Logout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Moving description / app highlights -->
    <div class="app-marquee">
        <div class="app-marquee-inner">
            <span><i class="fas fa-bolt"></i> TV Stream PRO  Live TV,
                Movies, Series, Muziki, Katuni na Radio zote sehemu
                moja.</span>
            <span><i class="fas fa-mobile-alt"></i> Imeboreshwa kwa simu na
                TV Box  interface nyepesi, ya kisasa na yenye kasi.</span>
        </div>
    </div>

    <main class="app-shell">
        <!-- Search Results -->
        <div class="search-results" id="searchResults">
            <h2 class="results-header">Search Results</h2>
            <div class="content-grid" id="searchGrid"></div>
        </div>

        <!-- Hero Slider -->
        <section class="hero-section section" id="mainCarousel" data-animate>
            <div class="hero-grid">
                <div class="hero-media">
                    <div class="hero-slider" id="heroSlider"></div>
                    <div class="hero-progress" id="heroProgress"></div>
                    <div class="carousel-controls">
                        <button class="carousel-btn" type="button" onclick="prevSlide()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="carousel-btn" type="button" onclick="nextSlide()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="hero-strip" id="heroStrip"></div>
                </div>
                <div class="hero-details">
                    <p class="pill" id="heroTag">On Air</p>
                    <h1 class="hero-title" id="heroTitle">TV Stream PRO</h1>
                    <p class="hero-description" id="heroDescription">
                        Carousel mpya hubadilisha scenes kila sekunde
                        chache, inabeba preview zilizo hai na CTA
                        zinazofuatilia channel uliyogusa.
                    </p>
                    <div class="hero-meta">
                        <span><i class="fas fa-signal"></i>
                            <span id="heroQuality">Auto</span></span>
                        <span><i class="fas fa-clapperboard"></i>
                            <span id="heroGenre">General</span></span>
                    </div>
                    <div class="hero-actions">
                        <button class="action-btn btn-primary" type="button" id="heroWatchBtn">
                            <i class="fas fa-play"></i> Watch Now
                        </button>
                        <button class="action-btn btn-secondary" type="button" id="heroFavoriteBtn">
                            <i class="fas fa-heart"></i> Add to Favorites
                        </button>
                    </div>
                    <div class="hero-stats">
                        <div class="stat-card">
                            <span>Live Channels</span>
                            <strong id="statLive">00</strong>
                        </div>
                        <div class="stat-card">
                            <span>Categories</span>
                            <strong id="statCategories">00</strong>
                        </div>
                        <div class="stat-card">
                            <span>Favorites</span>
                            <strong id="statFavorites">00</strong>
                        </div>
                    </div>
                </div>
                <div class="hero-gallery" id="heroGallery"></div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="quick-actions section" data-animate style="--delay: 0.05s">
            <div class="quick-grid">
                <button class="quick-card glass-panel" type="button" onclick="jumpToCategory('live-tv')">
                    <i class="fas fa-broadcast-tower"></i>
                    Live TV
                    <small>Channels zinazoendelea sasa</small>
                </button>
                <button class="quick-card glass-panel" type="button" onclick="jumpToCategory('movies')">
                    <i class="fas fa-film"></i>
                    Movies
                    <small>Matini ya sinema mpya</small>
                </button>
                <button class="quick-card glass-panel" type="button" onclick="jumpToCategory('radio')">
                    <i class="fas fa-headphones"></i>
                    Radio
                    <small>Muziki + talk shows</small>
                </button>
                <button class="quick-card glass-panel" type="button" onclick="jumpToCategory('sports')">
                    <i class="fas fa-football-ball"></i>
                    Sports
                    <small>Mechi na highlights</small>
                </button>
            </div>
        </section>

        <!-- Sports IPTV Playlist Section -->
        <section class="sports-section section" id="sportsPlaylist" data-animate style="--delay: 0.12s">
            <div class="section-header-grid">
                <div>
                    <p class="section-eyebrow">
                        <i class="fas fa-satellite-dish"></i> IPTV Sports
                        Deck
                    </p>
                    <h2 class="section-title">
                        Chagua channel ya michezo live
                    </h2>
                    <p class="section-subtitle">
                        Tumia playlists kutoka iptv-org kuchunguza michezo,
                        news au burudani kisha cheza kwenye player mpya bila
                        kufunga carousel ya juu.
                    </p>
                </div>
                <button class="floating-pill" type="button" onclick="refreshSportsCategory()">
                    <i class="fas fa-rotate"></i>
                    Refresh list
                </button>
            </div>
            <div class="sports-layout glass-panel">
                <div class="sports-player-panel">
                    <div class="sports-player-meta">
                        <p class="floating-pill" id="sportsCurrentCategory">
                            Hakuna kipengele kimechaguliwa
                        </p>
                        <h3 id="sportsChannelTitle">
                            Chagua channel upande wa kulia
                        </h3>
                        <p class="section-subtitle" id="sportsChannelMeta">
                            Tunavuta data moja kwa moja kutoka playlists za
                            iptv-org.
                        </p>
                    </div>
                    <div class="sports-player-shell">
                        <video id="sportsPlayer" controls playsinline webkit-playsinline x5-playsinline
                            poster="https://via.placeholder.com/1200x675/050308/FFFFFF?text=IPTV+Player">
                            <source id="sportsPlayerSource" src="" type="application/x-mpegURL" />
                        </video>
                        <div class="sports-player-status" id="sportsPlayerStatus">
                            <i class="fas fa-satellite-dish"></i>
                            <span>Hakuna stream inayoendelea.</span>
                        </div>
                    </div>
                </div>
                <div class="sports-browser">
                    <div class="sports-tabs" id="sportsCategoryTabs"></div>
                    <div class="sports-channel-list" id="sportsChannelList">
                        <div class="channel-placeholder">
                            Chagua kipengele ili kuona chaneli zote.
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Categories -->
        <div class="categories-nav section" data-animate style="--delay: 0.15s">
            <button class="category-btn active" data-category="live-tv" onclick="showCategory('live-tv', this)">
                <i class="fas fa-tv"></i>
                <span>Live TV</span>
            </button>
            <button class="category-btn" data-category="local-tv" onclick="showCategory('local-tv', this)">
                <i class="fas fa-city"></i>
                <span>Local TV</span>
            </button>
            <button class="category-btn" data-category="international-tv"
                onclick="showCategory('international-tv', this)">
                <i class="fas fa-globe"></i>
                <span>World TV</span>
            </button>
            <button class="category-btn" data-category="movies" onclick="showCategory('movies', this)">
                <i class="fas fa-film"></i>
                <span>Movies</span>
            </button>
            <button class="category-btn" data-category="series" onclick="showCategory('series', this)">
                <i class="fas fa-tv"></i>
                <span>Series</span>
            </button>
            <button class="category-btn" data-category="music" onclick="showCategory('music', this)">
                <i class="fas fa-music"></i>
                <span>Music</span>
            </button>
            <button class="category-btn" data-category="cartoons" onclick="showCategory('cartoons', this)">
                <i class="fas fa-child"></i>
                <span>Cartoons</span>
            </button>
            <button class="category-btn" data-category="sports" onclick="showCategory('sports', this)">
                <i class="fas fa-futbol"></i>
                <span>Sports</span>
            </button>
            <button class="category-btn" data-category="news" onclick="showCategory('news', this)">
                <i class="fas fa-newspaper"></i>
                <span>News</span>
            </button>
            <button class="category-btn" data-category="documentary" onclick="showCategory('documentary', this)">
                <i class="fas fa-book-open"></i>
                <span>Documentary</span>
            </button>
            <button class="category-btn" data-category="gospel" onclick="showCategory('gospel', this)">
                <i class="fas fa-church"></i>
                <span>Gospel</span>
            </button>
            <button class="category-btn" data-category="education" onclick="showCategory('education', this)">
                <i class="fas fa-graduation-cap"></i>
                <span>Education</span>
            </button>
            <button class="category-btn" data-category="radio" onclick="showCategory('radio', this)">
                <i class="fas fa-broadcast-tower"></i>
                <span>Radio</span>
            </button>
        </div>

        <!-- Category Section -->
        <section class="category-section section" id="categorySection" data-animate style="--delay: 0.2s">
            <div class="section-header">
                <h2 class="category-title" id="categoryTitle">
                    Live TV Channels
                </h2>
                <div class="view-toggle">
                    <div class="view-btn active" onclick="toggleView('grid')" title="Grid View">
                        <i class="fas fa-th"></i>
                    </div>
                    <div class="view-btn" onclick="toggleView('list')" title="List View">
                        <i class="fas fa-list"></i>
                    </div>
                </div>
            </div>
            <div class="content-grid" id="contentGrid"></div>
        </section>

        <!-- About Section -->
        <section class="about-section section" id="about" data-animate style="--delay: 0.25s">
            <div class="about-headline">
                <p class="eyebrow">Neon Flow</p>
                <h2>
                    Burudani, taarifa na michezo zinapita kama slide moja.
                </h2>
                <div class="about-swap">
                    <span>Daima:</span>
                    <span id="aboutTicker">Ultra fast loading</span>
                </div>
            </div>
            <div class="about-grid">
                <article class="about-card glass-panel">
                    <i class="fas fa-layer-group"></i>
                    <h3>Adaptive Motion</h3>
                    <p>
                        Spring + fade mchanganyiko unaofuata nguvu ya kifaa.
                    </p>
                </article>
                <article class="about-card glass-panel">
                    <i class="fas fa-robot"></i>
                    <h3>AI Rails</h3>
                    <p>
                        Highlights, chips na swipes za utabiri
                        zimeunganishwa.
                    </p>
                </article>
                <article class="about-card glass-panel">
                    <i class="fas fa-sliders-h"></i>
                    <h3>Precision Controls</h3>
                    <p>
                        Mipangilio inafungua kama command palette, realtime
                        preview.
                    </p>
                </article>
                <article class="about-card glass-panel">
                    <i class="fas fa-circle-play"></i>
                    <h3>Unified Player</h3>
                    <p>Retries smart + demo fallback bila kuacha modal.</p>
                </article>
            </div>
        </section>
    </main>

    <!-- Settings Drawer -->
    <div class="settings-overlay" id="settingsOverlay"></div>
    <aside class="settings-panel" id="settingsPanel" aria-hidden="true">
        <div class="settings-header">
            <div>
                <p class="eyebrow">Personalize</p>
                <h3>Badili muonekano & tabia za app papo hapo</h3>
                <p class="settings-status" id="settingsStatus">
                    Chagua chaguo unazozipendelea kisha bonyeza Hifadhi.
                </p>
            </div>
            <button class="icon-btn" id="closeSettingsBtn" type="button" aria-label="Funga Settings">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="settings-body">
            <div class="settings-group">
                <h4>Muonekano</h4>
                <div class="settings-item">
                    <div class="settings-text">
                        <h5>Tema nyepesi</h5>
                        <p>Badili rangi kuwa mwanga (default ni giza)</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="themeSwitch" />
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-text">
                        <h5>Punguza animation</h5>
                        <p>
                            Inapunguza motion & blur kwa kifaa chenye nguvu
                            ndogo
                        </p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="motionSwitch" />
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-text">
                        <h5>Data Saver</h5>
                        <p>Zima autoplay na viwango vya juu vya video</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="dataSaverSwitch" />
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="settings-group">
                <h4>Utendaji</h4>
                <div class="settings-item">
                    <div class="settings-text">
                        <h5>Carousel Autoplay</h5>
                        <p>Washa/slideshow ya live streams juu</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="autoplaySwitch" />
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-text">
                        <h5>Taarifa za Favorites</h5>
                        <p>Pokea arifa ndogo ndani ya app zikibadilika</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="notificationsSwitch" />
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="settings-item">
                    <div class="settings-text">
                        <h5>Lugha ya interface</h5>
                        <p>Chagua kati ya Kiswahili au English</p>
                    </div>
                    <select id="languageSelect" class="settings-select">
                        <option value="sw">Kiswahili</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="settings-footer">
            <button type="button" id="resetSettingsBtn">Rejesha</button>
            <button type="button" class="primary" id="saveSettingsBtn">
                Hifadhi
            </button>
        </div>
    </aside>

    <!-- Floating Video Player -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <div class="data-saver-banner" id="dataSaverBanner">
                <i class="fas fa-leaf"></i>
                <span>Data Saver imewashwa - video autoplay imezimwa ili
                    kupunguza matumizi ya data.</span>
            </div>
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"></h2>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-main">
                <div class="modal-video">
                    <video id="modalVideo" controls playsinline webkit-playsinline x5-playsinline
                        x5-video-player-type="h5" x5-video-player-fullscreen="true" preload="metadata"
                        crossorigin="anonymous" controlsList="nodownload noplaybackrate">
                        <source id="modalSource" src="" type="application/x-mpegURL" />
                    </video>
                    <div class="player-status" id="playerStatus">
                        <i class="fas fa-satellite-dish"></i>
                        <span>Inajiandaa kucheza...</span>
                    </div>
                </div>
                <div class="video-controls">
                    <div class="control-group">
                        <span class="control-label">Quality:</span>
                        <select class="control-select" id="qualitySelect">
                            <option>Auto</option>
                            <option>1080p</option>
                            <option>720p</option>
                            <option>480p</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Speed:</span>
                        <select class="control-select" id="speedSelect" onchange="changePlaybackSpeed(this.value)">
                            <option value="0.5">0.5x</option>
                            <option value="0.75">0.75x</option>
                            <option value="1" selected>1x</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2x</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Sauti:</span>
                        <input type="range" id="volumeRange" class="control-range" min="0" max="1" step="0.05" value="1"
                            oninput="changeVolume(this.value)" />
                    </div>
                    <div class="control-group">
                        <button class="action-btn btn-secondary" type="button" onclick="toggleFullscreen()">
                            <i class="fas fa-expand"></i>
                            Fullscreen
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-side" id="modalSide">
                <div class="modal-meta">
                    <p class="floating-pill">
                        <i class="fas fa-wave-square"></i> Live signal
                    </p>
                    <h3 id="modalInfoTitle">Live Channel</h3>
                    <p id="modalInfoDesc">
                        Stream moja kwa moja inayoendelea bila kingamizi.
                    </p>
                    <div class="meta-chipset">
                        <span class="meta-chip" id="modalInfoQuality">Auto</span>
                        <span class="meta-chip" id="modalInfoGenre">General</span>
                    </div>
                </div>
                <div class="modal-shortcuts">
                    <button class="primary" type="button" onclick="addCurrentStreamToFavorites()">
                        <i class="fas fa-heart"></i> Toggle Favorites
                    </button>
                    <button class="secondary" type="button" onclick="window.location.href='./football-ai.html'">
                        <i class="fas fa-robot"></i> Fungua AI Predictions
                    </button>
                </div>
                <div class="modal-tip">
                    <i class="fas fa-circle-info"></i>
                    <span>Ukiona sekunde kadhaa bila picha, player
                        atabadilisha hadi stream ya mfano ili uendelee
                        kuangalia.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <button class="icon-btn" onclick="closeNotificationsPanel()" style="width: 32px; height: 32px">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notifications-body" id="notificationsBody">
            <div class="notifications-empty">Loading notifications...</div>
        </div>
    </div>

    <div class="app-toast" id="appToast" role="status" aria-live="polite"></div>

    <!-- Social Links -->
    <section class="social-section section" id="social" data-animate style="--delay: 0.3s">
        <div class="section-header" style="margin-bottom: 20px">
            <h2 class="category-title" style="font-size: 32px">
                Connect With Us
            </h2>
        </div>
        <div class="social-grid">
            <article class="social-card glass-panel">
                <h4><i class="fab fa-tiktok"></i> TikTok</h4>
                <a href="https://www.tiktok.com/@techboy-tz" target="_blank" rel="noopener">techboy-tz</a>
                <small>Vipande vya haraka vya maboresho na sneak peeks.</small>
            </article>
            <article class="social-card glass-panel">
                <h4><i class="fab fa-facebook"></i> Facebook</h4>
                <a href="https://www.facebook.com/khazrymakoi" target="_blank" rel="noopener">Khazry Makoi</a>
                <small>Pata masasisho marefu na community posts.</small>
            </article>
            <article class="social-card glass-panel">
                <h4><i class="fab fa-instagram"></i> Instagram</h4>
                <a href="https://www.instagram.com/makoi_tz" target="_blank" rel="noopener">@makoi_tz</a>
                <small>Stories, makala na muonekano wa nyuma ya pazia.</small>
            </article>
            <article class="social-card glass-panel">
                <h4><i class="fab fa-youtube"></i> YouTube</h4>
                <a href="https://www.youtube.com/channel/UC5SAHE3iuyPU64DTdvUgssw" target="_blank"
                    rel="noopener">HackerTick</a>
                <small>Video tutorials na matangazo mapya ya TV Stream
                    PRO.</small>
            </article>
        </div>
    </section>

    <!-- Bottom Scrolling Marquee -->
    <div class="bottom-marquee">
        <div class="bottom-marquee-inner">
            <span> <strong>TV Stream PRO</strong> - Live TV, Movies,
                Series, Muziki na Radio zote sehemu moja</span>
            <span> Imeboreshwa kwa simu na TV Box - Interface ya kisasa na
                yenye kasi</span>
            <span> AI Predictions inapatikana - Tazama utabiri wa mechi za
                soka</span>
            <span> Pata taarifa za muhimu za app kupitia
                notifications</span>
            <span> Ongeza maudhui unayopenda kwenye Favorites kwa ufikiaji
                rahisi</span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.13/dist/hls.min.js"></script>
    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script>
        // Data from backend
        let liveStreams = [];
        let categoryData = {};
        const streamLookup = {};
        let iptvCategories = [];
        const defaultIptvCategories = [
            {
                key: "lifestyle",
                label: "Lifestyle",
                count: 70,
                url: "https://iptv-org.github.io/iptv/categories/lifestyle.m3u",
            },
            {
                key: "movies",
                label: "Movies",
                count: 265,
                url: "https://iptv-org.github.io/iptv/categories/movies.m3u",
            },
            {
                key: "music",
                label: "Music",
                count: 396,
                url: "https://iptv-org.github.io/iptv/categories/music.m3u",
            },
            {
                key: "news",
                label: "News",
                count: 502,
                url: "https://iptv-org.github.io/iptv/categories/news.m3u",
            },
            {
                key: "outdoor",
                label: "Outdoor",
                count: 42,
                url: "https://iptv-org.github.io/iptv/categories/outdoor.m3u",
            },
            {
                key: "relax",
                label: "Relax",
                count: 15,
                url: "https://iptv-org.github.io/iptv/categories/relax.m3u",
            },
            {
                key: "religious",
                label: "Religious",
                count: 310,
                url: "https://iptv-org.github.io/iptv/categories/religious.m3u",
            },
            {
                key: "series",
                label: "Series",
                count: 166,
                url: "https://iptv-org.github.io/iptv/categories/series.m3u",
            },
            {
                key: "science",
                label: "Science",
                count: 23,
                url: "https://iptv-org.github.io/iptv/categories/science.m3u",
            },
        ];
        const IPTV_PLAYLISTS_ENDPOINT = "/api/iptv-playlists";
        const iptvCache = {};
        let visibleSportsChannels = [];
        let activeSportsCategory = null;
        let activeSportsChannelId = null;
        let sportsPlayerHls = null;

        // State Management
        let currentSlide = 0;
        let currentCategory = "live-tv";
        let currentView = "grid";
        let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
        let searchTimeout;
        const preferencesKey = "tvStreamPreferences";
        const defaultPreferences = {
            theme: "dark",
            autoPlayCarousel: true,
            reduceMotion: false,
            dataSaver: false,
            interfaceLanguage: "sw",
            notifications: true,
        };
        const DEFAULT_STREAM_FALLBACK =
            "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";
        let appPreferences = (() => {
            try {
                const stored = JSON.parse(
                    localStorage.getItem(preferencesKey),
                );
                if (stored) {
                    return { ...defaultPreferences, ...stored };
                }
            } catch (err) {
                console.warn("Failed to parse saved preferences", err);
            }
            return { ...defaultPreferences };
        })();
        let carouselIntervalId = null;
        const AUTH_STORAGE_KEY = "tvStreamUser";
        let notifications = [];
        let notificationCheckInterval = null;
        let hlsPlayer = null;
        let playerStatusTimeout = null;
        let playerRetryCount = 0;
        const MAX_PLAYER_RETRIES = 2;
        const defaultHeroArtwork =
            "https://images.unsplash.com/photo-1525182008055-f88b95ff7980?auto=format&fit=crop&w=1400&q=80";
        const htmlEscapeMap = {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
        };
        let sportsPlayerEventsBound = false;
        let iptvCategoriesLoaded = false;

        function escapeHtml(value = "") {
            const safeValue =
                value === null || value === undefined ? "" : value;
            return String(safeValue).replace(
                /[&<>"']/g,
                (char) => htmlEscapeMap[char] || char,
            );
        }

        function getDefaultIptvCategories() {
            return defaultIptvCategories.map((cat) => ({ ...cat }));
        }

        function toSlug(input = "", fallback = "category") {
            const base = input || fallback;
            return (
                base
                    .toString()
                    .trim()
                    .toLowerCase()
                    .replace(/[^a-z0-9]+/g, "-")
                    .replace(/^-+|-+$/g, "") || fallback
            );
        }

        function normalizeIptvCategory(cat = {}, index = 0) {
            const label =
                cat.label ||
                cat.title ||
                cat.name ||
                `Playlist ${index + 1}`;
            const key = (
                cat.key ||
                cat.slug ||
                toSlug(label, `cat-${index + 1}`)
            ).toLowerCase();
            const url = cat.playlistUrl || cat.url || cat.playlist || "";
            const channels = Array.isArray(cat.channels)
                ? [...cat.channels]
                : [];
            const count = cat.count || channels.length || cat.total || 0;
            return {
                key,
                label,
                url,
                count,
                channels,
            };
        }

        function normalizeAdminChannel(
            channel = {},
            index = 0,
            categoryKey = "",
        ) {
            const streamUrl =
                channel.url ||
                channel.streamUrl ||
                channel.playlistUrl ||
                channel.link;
            if (!streamUrl) return null;
            const title =
                channel.title || channel.name || `Channel ${index + 1}`;
            return {
                id: `${categoryKey || "cat"}-admin-${index + 1}`,
                title,
                url: streamUrl,
                logo: channel.logo || channel.icon || "",
                group: channel.group || channel.genre || "",
                tvgLanguage: channel.language || channel.lang || "",
            };
        }

        function getCategoryByKey(key) {
            if (!key) return null;
            return (
                iptvCategories.find((cat) => cat.key === key) ||
                defaultIptvCategories.find((cat) => cat.key === key) ||
                null
            );
        }

        function getCategoryLabel(key) {
            return getCategoryByKey(key)?.label || "IPTV";
        }

        function cloneCategory(category = {}) {
            return {
                key: category.key,
                label: category.label,
                url: category.url || category.playlistUrl || "",
                playlistUrl: category.playlistUrl || category.url || "",
                count: category.count || 0,
                channels: Array.isArray(category.channels)
                    ? [...category.channels]
                    : [],
            };
        }

        function mergeIptvCategories(customList = []) {
            const merged = new Map();
            defaultIptvCategories.forEach((cat) => {
                if (!cat?.key) return;
                merged.set(cat.key, cloneCategory(cat));
            });
            customList.forEach((cat) => {
                if (!cat?.key) return;
                merged.set(cat.key, cloneCategory(cat));
            });
            return Array.from(merged.values());
        }
        let lastPlaybackContext = {
            isMobile: false,
            autoplayAllowed: false,
        };
        const fallbackMatches = [
            {
                league: "Premier League",
                homeTeam: "Manchester City",
                awayTeam: "Arsenal",
                homeScore: 2,
                awayScore: 1,
                status: "live",
                minute: 64,
                venue: "Etihad Stadium",
            },
            {
                league: "La Liga",
                homeTeam: "Barcelona",
                awayTeam: "Real Betis",
                homeScore: 0,
                awayScore: 0,
                status: "scheduled",
                time: "21:00",
                venue: "Estadi Olmpic",
            },
            {
                league: "Serie A",
                homeTeam: "Inter Milan",
                awayTeam: "Juventus",
                homeScore: 1,
                awayScore: 1,
                status: "finished",
                venue: "San Siro",
            },
        ];
        const aboutHighlights = [
            "Ultra fast loading",
            "AI tuned match tips",
            "Player ana fallback ya papo hapo",
            "Notifications ndogo zisizo kusumbua",
        ];
        let aboutHighlightIndex = 0;
        let aboutTickerTimer = null;

        // Initialize
        window.addEventListener("DOMContentLoaded", function () {
            const liveTvBtn = document.querySelector(
                ".category-btn.active",
            );
            setupEventListeners();
            setupModernPlayer();
            initSportsPlaylist();
            applyPreferencesToDom();
            registerServiceWorker();
            startAboutTicker();
            loadStreamsFromApi().then(() => {
                showCategory("live-tv", liveTvBtn);
                updateCarousel();
                updateFavoritesButton();
                manageCarouselAutoRotate();
                // Hide loading after everything is loaded
                setTimeout(() => hideLoading(), 500);
            });
            loadNotifications();
            startNotificationPolling();
            // Update user badge without requiring authentication
            updateUserBadge(null);
        });

        // Also hide loading when page is fully loaded
        window.addEventListener("load", function () {
            setTimeout(() => hideLoading(), 300);
        });

        // Load data from API
        async function loadStreamsFromApi() {
            showLoading();
            try {
                const res = await fetch("/api/streams");
                if (!res.ok) throw new Error("Failed to load streams");
                const data = await res.json();
                categoryData = data.categoryData || {};
                hydrateStreamLookup();
                liveStreams = enhanceFeaturedStreams(
                    data.liveStreams || [],
                );
                ensureHeroData();
            } catch (err) {
                console.error(err);
                if (!liveStreams.length) {
                    liveStreams = [
                        {
                            id: 1,
                            title: "Live TV Channel 1",
                            description:
                                "Default demo stream (configure via admin dashboard)",
                            streamUrl:
                                "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",
                            quality: "1080p",
                            genre: "Demo",
                            thumbnail:
                                "https://via.placeholder.com/1200x675/111/ffffff?text=TV+Stream+PRO",
                        },
                    ];
                }
                if (!Object.keys(categoryData).length) {
                    categoryData = {
                        "live-tv": {
                            title: "Live TV Channels",
                            items: liveStreams.map((item) => ({
                                id: item.id,
                                title: item.title,
                                thumbnail:
                                    item.thumbnail ||
                                    "https://via.placeholder.com/300x450/667eea/ffffff?text=Demo",
                                streamUrl: item.streamUrl,
                                year: "2024",
                                rating: "4.8",
                            })),
                        },
                    };
                }
                hydrateStreamLookup();
                liveStreams = enhanceFeaturedStreams(liveStreams);
            } finally {
                ensureHeroData();
                initializeHeroCarousel();
                updateHeroStats();
                hideLoading();
            }
        }

        // Sports IPTV Playlist
        async function loadIptvCategoriesFromAdmin() {
            try {
                const response = await fetch(IPTV_PLAYLISTS_ENDPOINT, {
                    headers: { Accept: "application/json" },
                    cache: "no-store",
                });
                if (!response.ok) {
                    throw new Error(
                        `Failed to load IPTV playlists (${response.status})`,
                    );
                }
                const payload = await response.json();
                const categories = Array.isArray(payload?.categories)
                    ? payload.categories
                    : [];
                return categories
                    .map((cat, index) => normalizeIptvCategory(cat, index))
                    .filter(
                        (cat) =>
                            cat.key &&
                            (cat.url ||
                                (cat.channels && cat.channels.length)),
                    );
            } catch (error) {
                console.warn("IPTV admin playlist fetch failed:", error);
                return [];
            }
        }

        async function ensureIptvCategoriesLoaded(forceRefresh = false) {
            if (
                !forceRefresh &&
                iptvCategoriesLoaded &&
                iptvCategories.length
            ) {
                return;
            }
            if (forceRefresh) {
                Object.keys(iptvCache).forEach(
                    (key) => delete iptvCache[key],
                );
            }
            const adminCategories = await loadIptvCategoriesFromAdmin();
            iptvCategories = mergeIptvCategories(adminCategories);
            iptvCategoriesLoaded = true;
        }

        async function initSportsPlaylist() {
            const tabs = document.getElementById("sportsCategoryTabs");
            const list = document.getElementById("sportsChannelList");
            const player = document.getElementById("sportsPlayer");
            if (!tabs || !list || !player) return;
            await ensureIptvCategoriesLoaded();
            if (!iptvCategories.length) {
                list.innerHTML =
                    '<div class="channel-error">Hakuna playlists zimeongezwa bado. Tafadhali tumia admin dashboard kuongeza.</div>';
                return;
            }
            wireSportsPlayerEvents();
            renderSportsCategoryTabs();
            const defaultKey =
                activeSportsCategory || iptvCategories[0]?.key;
            if (defaultKey) {
                selectSportsCategory(defaultKey);
            }
        }

        function wireSportsPlayerEvents() {
            if (sportsPlayerEventsBound) return;
            const video = document.getElementById("sportsPlayer");
            if (!video) return;
            sportsPlayerEventsBound = true;
            video.addEventListener("waiting", () =>
                updateSportsPlayerStatus(
                    "Ina-buffer...",
                    "fa-spinner",
                    true,
                ),
            );
            video.addEventListener("playing", () =>
                updateSportsPlayerStatus("Inacheza sasa", "fa-play"),
            );
            video.addEventListener("pause", () =>
                updateSportsPlayerStatus("Imewekwa pause", "fa-pause"),
            );
            video.addEventListener("error", () =>
                updateSportsPlayerStatus(
                    "Hitilafu ya player, jaribu channel nyingine",
                    "fa-triangle-exclamation",
                ),
            );
        }

        function renderSportsCategoryTabs() {
            const container = document.getElementById("sportsCategoryTabs");
            if (!container) return;
            if (!iptvCategories.length) {
                container.innerHTML =
                    '<div class="channel-placeholder">Hakuna playlists zilizopatikana.</div>';
                return;
            }
            container.innerHTML = iptvCategories
                .map(
                    (cat) => `
                <button class="sports-tab ${cat.key === activeSportsCategory ? "active" : ""}" data-key="${cat.key}">
                    <span>${escapeHtml(cat.label)}</span>
                    <small>${cat.count || 0}</small>
                </button>
            `,
                )
                .join("");
            container.querySelectorAll(".sports-tab").forEach((btn) => {
                btn.addEventListener("click", () =>
                    selectSportsCategory(btn.dataset.key),
                );
            });
        }

        async function selectSportsCategory(key, options = {}) {
            if (!key) return;
            const category = getCategoryByKey(key);
            if (!category) return;
            if (options.forceRefresh) {
                delete iptvCache[key];
            }
            activeSportsCategory = key;
            activeSportsChannelId = null;
            renderSportsCategoryTabs();
            const listEl = document.getElementById("sportsChannelList");
            if (listEl) {
                listEl.innerHTML =
                    '<div class="channel-placeholder">Inapakia chaneli kutoka playlist...</div>';
            }
            updateSportsCategoryLabel(category, 0);
            updateSportsPlayerStatus(
                "Inasubiri uchague channel...",
                "fa-hand-pointer",
            );
            try {
                const channels = await loadIptvCategory(key);
                renderSportsChannelList(channels);
                const catIndex = iptvCategories.findIndex(
                    (cat) => cat.key === key,
                );
                if (catIndex !== -1) {
                    iptvCategories[catIndex].count = channels.length;
                    renderSportsCategoryTabs();
                }
                updateSportsCategoryLabel(category, channels.length);
                if (!channels.length) {
                    updateSportsPlayerStatus(
                        "Hakuna chaneli kwenye playlist hii",
                        "fa-circle-info",
                    );
                }
            } catch (error) {
                console.error("Failed to load IPTV category", error);
                if (listEl) {
                    listEl.innerHTML =
                        '<div class="channel-error">Imeshindikana kupakua playlist. Jaribu tena baadaye.</div>';
                }
                updateSportsPlayerStatus(
                    "Imeshindikana kuunganisha playlist",
                    "fa-triangle-exclamation",
                );
            }
        }

        async function refreshSportsCategory() {
            await ensureIptvCategoriesLoaded(true);
            const availableKeys = iptvCategories.map((cat) => cat.key);
            const fallback =
                availableKeys[0] || defaultIptvCategories[0]?.key;
            const prefersCurrent =
                activeSportsCategory &&
                    availableKeys.includes(activeSportsCategory)
                    ? activeSportsCategory
                    : null;
            const target = prefersCurrent || fallback;
            if (target) {
                selectSportsCategory(target, { forceRefresh: true });
            } else {
                const listEl = document.getElementById("sportsChannelList");
                if (listEl) {
                    listEl.innerHTML =
                        '<div class="channel-error">Hakuna playlists zilizopo. Ongeza kupitia admin dashboard.</div>';
                }
            }
        }

        async function loadIptvCategory(key) {
            if (iptvCache[key]) {
                return iptvCache[key];
            }
            const category =
                iptvCategories.find((cat) => cat.key === key) ||
                getCategoryByKey(key);
            if (!category) return [];
            if (
                Array.isArray(category.channels) &&
                category.channels.length
            ) {
                const normalized = category.channels
                    .map((channel, index) =>
                        normalizeAdminChannel(channel, index, category.key),
                    )
                    .filter(Boolean);
                iptvCache[key] = normalized;
                return normalized;
            }
            if (!category.url) {
                return [];
            }
            const response = await fetch(category.url);
            if (!response.ok) {
                throw new Error(`Failed to fetch playlist for ${key}`);
            }
            const playlistText = await response.text();
            const parsed = parseM3UPlaylist(playlistText, key);
            iptvCache[key] = parsed;
            return parsed;
        }

        function parseM3UPlaylist(text = "", categoryKey = "") {
            const lines = text.split(/\r?\n/);
            const channels = [];
            let current = null;
            lines.forEach((rawLine) => {
                const line = rawLine.trim();
                if (!line) return;
                if (line.startsWith("#EXTINF")) {
                    const name =
                        line.split(",").pop()?.trim() || "Live Channel";
                    const logoMatch = line.match(/tvg-logo="([^"]*)"/i);
                    const groupMatch = line.match(/group-title="([^"]*)"/i);
                    const langMatch = line.match(/tvg-language="([^"]*)"/i);
                    current = {
                        title: name,
                        logo: logoMatch?.[1] || "",
                        group: groupMatch?.[1] || "",
                        tvgLanguage: langMatch?.[1] || "",
                        categoryKey,
                    };
                } else if (!line.startsWith("#") && current) {
                    const channel = {
                        ...current,
                        id: `${categoryKey}-${channels.length + 1}`,
                        url: line,
                    };
                    channels.push(channel);
                    current = null;
                }
            });
            return channels;
        }

        function renderSportsChannelList(channels = []) {
            const listEl = document.getElementById("sportsChannelList");
            if (!listEl) return;
            visibleSportsChannels = channels;
            if (!channels.length) {
                listEl.innerHTML =
                    '<div class="channel-placeholder">Hakuna chaneli kwenye playlist hii.</div>';
                return;
            }
            const categoryLabel = getCategoryLabel(activeSportsCategory);
            listEl.innerHTML = channels
                .map(
                    (channel) => `
                <button class="channel-item ${channel.id === activeSportsChannelId ? "active" : ""}" data-channel-id="${channel.id}">
                    ${channel.logo ? `<img src="${escapeHtml(channel.logo)}" alt="${escapeHtml(channel.title)}" onerror="this.style.display='none'">` : '<div class="channel-placeholder-logo"><i class="fas fa-tv"></i></div>'}
                    <div class="channel-info">
                        <strong>${escapeHtml(channel.title)}</strong>
                        <span>${escapeHtml(channel.group || categoryLabel)}</span>
                    </div>
                    <i class="fas fa-play"></i>
                </button>
            `,
                )
                .join("");
            listEl.querySelectorAll(".channel-item").forEach((btn) => {
                btn.addEventListener("click", () => {
                    const channelId = btn.dataset.channelId;
                    const target = visibleSportsChannels.find(
                        (ch) => ch.id === channelId,
                    );
                    if (target) {
                        playSportsChannel(target);
                    }
                });
            });
        }

        function updateSportsCategoryLabel(category, total = 0) {
            const pill = document.getElementById("sportsCurrentCategory");
            if (!pill) return;
            const label =
                category?.label ||
                getCategoryLabel(category?.key || activeSportsCategory);
            const count = total || category?.count || 0;
            pill.textContent = `${label}  ${count} channels`;
        }

        function playSportsChannel(channel) {
            if (!channel) return;
            activeSportsChannelId = channel.id;
            highlightSportsChannel(channel.id);
            const titleEl = document.getElementById("sportsChannelTitle");
            const metaEl = document.getElementById("sportsChannelMeta");
            const categoryLabel = getCategoryLabel(activeSportsCategory);
            if (titleEl)
                titleEl.textContent = channel.title || "Live Channel";
            if (metaEl) {
                const metaParts = [
                    channel.group || categoryLabel,
                    channel.tvgLanguage,
                ].filter(Boolean);
                metaEl.textContent = metaParts.join("  ") || categoryLabel;
            }
            updateSportsPlayerStatus(
                "Inajiandaa kuunganisha stream...",
                "fa-spinner",
                true,
            );
            attachStreamToSportsPlayer(channel.url);
        }

        function highlightSportsChannel(channelId) {
            const listEl = document.getElementById("sportsChannelList");
            if (!listEl) return;
            listEl.querySelectorAll(".channel-item").forEach((item) => {
                item.classList.toggle(
                    "active",
                    item.dataset.channelId === channelId,
                );
            });
        }

        function attachStreamToSportsPlayer(url, { autoplay = true } = {}) {
            const video = document.getElementById("sportsPlayer");
            const source = document.getElementById("sportsPlayerSource");
            if (!video || !url) return;
            destroySportsHls();
            video.pause();
            video.removeAttribute("src");
            video.load();
            if (source) {
                source.removeAttribute("src");
                source.removeAttribute("type");
            }
            const isM3u8 = /\.m3u8(\?|$)/i.test(url);
            if (isM3u8 && window.Hls && window.Hls.isSupported()) {
                sportsPlayerHls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 60,
                    manifestLoadingTimeOut: 20000,
                });
                sportsPlayerHls.on(Hls.Events.MANIFEST_PARSED, () => {
                    updateSportsPlayerStatus(
                        "Signal imeunganishwa",
                        "fa-broadcast-tower",
                    );
                    if (autoplay) {
                        video
                            .play()
                            .catch(() =>
                                updateSportsPlayerStatus(
                                    "Bonyeza Play kuendelea",
                                    "fa-hand-pointer",
                                ),
                            );
                    }
                });
                sportsPlayerHls.on(Hls.Events.ERROR, (_, data) => {
                    console.warn("Sports HLS error", data);
                    if (data?.fatal) {
                        updateSportsPlayerStatus(
                            "Stream imekataa, chagua nyingine",
                            "fa-triangle-exclamation",
                        );
                    }
                });
                sportsPlayerHls.loadSource(url);
                sportsPlayerHls.attachMedia(video);
                return;
            }
            if (source) {
                source.src = url;
                source.type = isM3u8
                    ? "application/x-mpegURL"
                    : "video/mp4";
            } else {
                video.src = url;
            }
            video.load();
            video.addEventListener("loadeddata", function handleLoaded() {
                video.removeEventListener("loadeddata", handleLoaded);
                updateSportsPlayerStatus("Inacheza sasa", "fa-play");
                if (autoplay) {
                    video
                        .play()
                        .catch(() =>
                            updateSportsPlayerStatus(
                                "Bonyeza Play kuendelea",
                                "fa-hand-pointer",
                            ),
                        );
                }
            });
        }

        function destroySportsHls() {
            if (sportsPlayerHls) {
                sportsPlayerHls.destroy();
                sportsPlayerHls = null;
            }
        }

        function updateSportsPlayerStatus(
            message,
            icon = "fa-satellite-dish",
            spinning = false,
        ) {
            const statusEl = document.getElementById("sportsPlayerStatus");
            if (!statusEl) return;
            const iconEl = statusEl.querySelector("i");
            const textEl = statusEl.querySelector("span");
            if (iconEl) {
                iconEl.className = `fas ${icon}${spinning ? " fa-spin" : ""}`;
            }
            if (textEl) {
                textEl.textContent = message;
            }
        }

        // Register Service Worker for PWA
        function registerServiceWorker() {
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker
                    .register("./service-worker.js")
                    .then((registration) => {
                        console.log(
                            "Service Worker registered:",
                            registration,
                        );
                    })
                    .catch((error) => {
                        console.log(
                            "Service Worker registration failed:",
                            error,
                        );
                    });
            }
        }

        // Install PWA prompt
        let deferredPrompt;
        window.addEventListener("beforeinstallprompt", (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show install button if needed
            showInstallButton();
        });

        function showInstallButton() {
            // You can add an install button here
            console.log("App can be installed");
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === "accepted") {
                        console.log("User accepted the install prompt");
                    }
                    deferredPrompt = null;
                });
            }
        }

        // User Preferences (no authentication required)
        function getStoredUser() {
            // Optional: can still use stored user data if available, but not required
            try {
                return JSON.parse(localStorage.getItem(AUTH_STORAGE_KEY));
            } catch (error) {
                return null;
            }
        }

        function updateUserBadge(user) {
            const nameLabel = document.getElementById("userNameLabel");
            const greeting = document.getElementById("userGreeting");
            const avatar = document.getElementById("userAvatarInitial");
            if (!nameLabel || !greeting || !avatar) return;

            if (user) {
                const displayName = (
                    user.displayName ||
                    user.email ||
                    user.phoneNumber ||
                    "Member"
                ).trim();
                const shortName = displayName.split(" ")[0];
                nameLabel.textContent = shortName;
                greeting.textContent = "Karibu tena";
                avatar.textContent = (shortName[0] || "T").toUpperCase();
            } else {
                nameLabel.textContent = "Mgeni";
                greeting.textContent = "Karibu";
                avatar.textContent = "TS";
            }
        }

        function handleLogout() {
            localStorage.removeItem(AUTH_STORAGE_KEY);
            updateUserBadge(null);
            notifyUser("Umetoka kwenye akaunti");
        }

        function openSettingsPanel() {
            document
                .getElementById("settingsOverlay")
                ?.classList.add("active");
            const panel = document.getElementById("settingsPanel");
            if (panel) {
                panel.classList.add("active");
                panel.setAttribute("aria-hidden", "false");
            }
            hydrateSettingsForm();
        }

        function closeSettingsPanel() {
            document
                .getElementById("settingsOverlay")
                ?.classList.remove("active");
            const panel = document.getElementById("settingsPanel");
            if (panel) {
                panel.classList.remove("active");
                panel.setAttribute("aria-hidden", "true");
            }
        }

        function hydrateSettingsForm() {
            const themeSwitch = document.getElementById("themeSwitch");
            if (!themeSwitch) return;
            themeSwitch.checked = appPreferences.theme === "light";
            document.getElementById("autoplaySwitch").checked =
                !!appPreferences.autoPlayCarousel;
            document.getElementById("motionSwitch").checked =
                !!appPreferences.reduceMotion;
            document.getElementById("dataSaverSwitch").checked =
                !!appPreferences.dataSaver;
            document.getElementById("languageSelect").value =
                appPreferences.interfaceLanguage || "sw";
            document.getElementById("notificationsSwitch").checked =
                !!appPreferences.notifications;
        }

        function persistPreferencesFromUI() {
            appPreferences = {
                ...appPreferences,
                theme: document.getElementById("themeSwitch").checked
                    ? "light"
                    : "dark",
                autoPlayCarousel:
                    document.getElementById("autoplaySwitch").checked,
                reduceMotion:
                    document.getElementById("motionSwitch").checked,
                dataSaver:
                    document.getElementById("dataSaverSwitch").checked,
                interfaceLanguage:
                    document.getElementById("languageSelect").value,
                notifications: document.getElementById(
                    "notificationsSwitch",
                ).checked,
            };
            savePreferences();
            applyPreferencesToDom();
            setSettingsStatus("Mipangilio imehifadhiwa salama ");
        }

        function resetPreferences() {
            appPreferences = { ...defaultPreferences };
            savePreferences();
            applyPreferencesToDom();
            setSettingsStatus("Umerudisha mipangilio ya awali.");
        }

        function savePreferences() {
            localStorage.setItem(
                preferencesKey,
                JSON.stringify(appPreferences),
            );
        }

        function applyPreferencesToDom() {
            document.body.dataset.theme = appPreferences.theme;
            document.body.classList.toggle(
                "reduce-motion",
                appPreferences.reduceMotion,
            );
            document.body.classList.toggle(
                "data-saver",
                appPreferences.dataSaver,
            );
            document.documentElement.lang =
                appPreferences.interfaceLanguage || "sw";
            const dataSaverBanner =
                document.getElementById("dataSaverBanner");
            dataSaverBanner?.classList.toggle(
                "active",
                appPreferences.dataSaver,
            );
            hydrateSettingsForm();
            manageCarouselAutoRotate();
        }

        function setSettingsStatus(message) {
            const status = document.getElementById("settingsStatus");
            if (status) {
                status.textContent = message;
            }
        }

        function manageCarouselAutoRotate() {
            if (carouselIntervalId) {
                clearInterval(carouselIntervalId);
                carouselIntervalId = null;
            }
            if (appPreferences.autoPlayCarousel && liveStreams.length > 1) {
                carouselIntervalId = setInterval(() => {
                    nextSlide();
                }, 12000);
            }
        }

        function notifyUser(message) {
            if (!appPreferences.notifications) return;
            const toast = document.getElementById("appToast");
            if (!toast) return;
            toast.textContent = message;
            toast.classList.add("active");
            setTimeout(() => toast.classList.remove("active"), 2500);
        }

        function setupEventListeners() {
            const searchInput = document.getElementById("searchBox");
            const searchIcon = document.querySelector(".search-icon");
            const notificationsBtn =
                document.getElementById("notificationsBtn");
            const favoritesBtn = document.getElementById("favoritesBtn");
            const settingsBtn = document.getElementById("settingsBtn");
            const closeSettingsBtn =
                document.getElementById("closeSettingsBtn");
            const settingsOverlay =
                document.getElementById("settingsOverlay");
            const saveSettingsBtn =
                document.getElementById("saveSettingsBtn");
            const resetSettingsBtn =
                document.getElementById("resetSettingsBtn");
            const openSettingsFromMenuBtn = document.getElementById(
                "openSettingsFromMenu",
            );
            const userToggle = document.getElementById("userMenuToggle");
            const userMenu = document.getElementById("userMenu");
            const logoutBtn = document.getElementById("logoutBtn");
            const modalOverlay = document.getElementById("modalOverlay");

            if (searchInput) {
                searchInput.addEventListener("input", handleSearch);
            }
            if (searchIcon) {
                searchIcon.addEventListener("click", () =>
                    searchInput?.focus(),
                );
            }
            notificationsBtn?.addEventListener(
                "click",
                toggleNotificationsPanel,
            );
            favoritesBtn?.addEventListener("click", showFavorites);
            settingsBtn?.addEventListener("click", openSettingsPanel);
            closeSettingsBtn?.addEventListener("click", closeSettingsPanel);
            settingsOverlay?.addEventListener("click", closeSettingsPanel);
            saveSettingsBtn?.addEventListener(
                "click",
                persistPreferencesFromUI,
            );
            resetSettingsBtn?.addEventListener("click", resetPreferences);
            openSettingsFromMenuBtn?.addEventListener("click", () => {
                openSettingsPanel();
                userMenu?.classList.remove("active");
            });
            logoutBtn?.addEventListener("click", handleLogout);
            modalOverlay?.addEventListener("click", (e) => {
                if (e.target === modalOverlay) {
                    closeModal();
                }
            });

            if (userToggle && userMenu) {
                userToggle.addEventListener("click", (event) => {
                    event.stopPropagation();
                    userMenu.classList.toggle("active");
                });
                document.addEventListener("click", (event) => {
                    if (!userMenu.contains(event.target)) {
                        userMenu.classList.remove("active");
                    }
                });
            }

            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") {
                    closeModal();
                    closeSettingsPanel();
                }
                if (e.key === "ArrowLeft") prevSlide();
                if (e.key === "ArrowRight") nextSlide();
            });
        }

        // Carousel Functions
        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }

        function nextSlide() {
            if (!liveStreams.length) return;
            currentSlide = (currentSlide + 1) % liveStreams.length;
            updateCarousel();
        }

        function prevSlide() {
            if (!liveStreams.length) return;
            currentSlide =
                (currentSlide - 1 + liveStreams.length) %
                liveStreams.length;
            updateCarousel();
        }

        function updateCarousel() {
            if (!liveStreams.length) return;
            currentSlide =
                (currentSlide + liveStreams.length) % liveStreams.length;
            const slide = liveStreams[currentSlide];
            const heroSlider = document.getElementById("heroSlider");
            const heroTitle = document.getElementById("heroTitle");
            const heroDescription =
                document.getElementById("heroDescription");
            const heroQuality = document.getElementById("heroQuality");
            const heroGenre = document.getElementById("heroGenre");
            const heroTag = document.getElementById("heroTag");
            const watchBtn = document.getElementById("heroWatchBtn");
            const favoriteBtn = document.getElementById("heroFavoriteBtn");
            const artwork =
                slide.thumbnail ||
                getFallbackArtwork(slide.title) ||
                defaultHeroArtwork;

            if (heroSlider) {
                heroSlider.style.setProperty(
                    "--hero-image",
                    `url('${artwork}')`,
                );
                heroSlider.dataset.streamId = slide.id;
            }
            if (heroTitle)
                heroTitle.textContent = slide.title || "Live Channel";
            if (heroDescription) {
                heroDescription.textContent =
                    slide.description ||
                    "Endelea kufurahia maudhui mapya kila siku bila usumbufu.";
            }
            if (heroQuality)
                heroQuality.textContent = slide.quality || "Auto";
            if (heroGenre) heroGenre.textContent = slide.genre || "General";
            if (heroTag) heroTag.textContent = slide.genre || "On Air";
            if (watchBtn) {
                watchBtn.onclick = () => playStream(slide.id);
            }
            if (favoriteBtn) {
                favoriteBtn.onclick = () => toggleFavorite(slide.id);
            }

            highlightHeroStrip();
            renderHeroProgress();
            highlightHeroGallery(slide.id);
        }

        // Category Functions
        function showCategory(category, buttonElement) {
            currentCategory = category;
            const data = categoryData[category];

            if (!data) return;

            document.getElementById("categoryTitle").textContent =
                data.title;

            const buttons = document.querySelectorAll(".category-btn");
            buttons.forEach((btn) => btn.classList.remove("active"));
            if (buttonElement) buttonElement.classList.add("active");

            renderContentGrid(data.items);
            document
                .getElementById("searchResults")
                .classList.remove("active");
            document.getElementById("mainCarousel").style.display = "block";
            document.getElementById("categorySection").style.display =
                "block";
        }

        function renderContentGrid(items) {
            const grid = document.getElementById("contentGrid");
            grid.className = `content-grid ${currentView === "list" ? "list-view" : ""}`;
            if (!Array.isArray(items) || !items.length) {
                grid.innerHTML = `<div style="padding:40px;text-align:center;color:rgba(255,255,255,0.6);">Hakuna maudhui kwenye kipengele hiki kwa sasa.</div>`;
                return;
            }

            grid.innerHTML = items
                .map((item) => {
                    const safeTitle = item.title
                        .replace(/'/g, "\\'")
                        .replace(/"/g, "&quot;");
                    const isFavorited = favorites.includes(item.id);

                    return `
                    <div class="content-card" onclick="playStream(${item.id})">
                        <div class="card-image-wrapper">
                            <img src="${item.thumbnail}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/300x450/667eea/ffffff?text=No+Image'">
                            ${item.rating ? `<div class="card-badge"> ${item.rating}</div>` : ""}
                            <div class="card-overlay">
                                <button class="play-button">
                                    <i class="fas fa-play"></i>
                                </button>
                            </div>
                            <div class="card-actions">
                                <div class="card-action-btn ${isFavorited ? "favorited" : ""}" onclick="event.stopPropagation(); toggleFavorite(${item.id})" title="${isFavorited ? "Remove from Favorites" : "Add to Favorites"}">
                                    <i class="fas fa-heart"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card-info">
                            <h3 class="card-title">${item.title}</h3>
                            <div class="card-meta">
                                ${item.year ? `<span><i class="fas fa-calendar"></i> ${item.year}</span>` : ""}
                                ${item.rating ? `<span><i class="fas fa-star"></i> ${item.rating}</span>` : ""}
                            </div>
                        </div>
                    </div>
                `;
                })
                .join("");
        }

        function toggleView(view) {
            currentView = view;
            const grid = document.getElementById("contentGrid");
            grid.className = `content-grid ${view === "list" ? "list-view" : ""}`;

            document
                .querySelectorAll(".view-btn")
                .forEach((btn) => btn.classList.remove("active"));
            event.target.closest(".view-btn").classList.add("active");
        }

        function startAboutTicker() {
            const ticker = document.getElementById("aboutTicker");
            if (!ticker || !aboutHighlights.length) return;
            const swap = () => {
                aboutHighlightIndex =
                    (aboutHighlightIndex + 1) % aboutHighlights.length;
                ticker.style.opacity = 0;
                setTimeout(() => {
                    ticker.textContent =
                        aboutHighlights[aboutHighlightIndex];
                    ticker.style.opacity = 1;
                }, 180);
            };
            ticker.textContent = aboutHighlights[0];
            ticker.style.opacity = 1;
            if (aboutTickerTimer) clearInterval(aboutTickerTimer);
            aboutTickerTimer = setInterval(swap, 2600);
        }

        function jumpToCategory(category) {
            const button = document.querySelector(
                `.category-btn[data-category="${category}"]`,
            );
            showCategory(category, button);
            document
                .getElementById("categorySection")
                ?.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        function playStream(streamId, fallbackUrl, fallbackTitle) {
            const info = streamLookup[streamId];
            if (info) {
                const idx = liveStreams.findIndex(
                    (item) => item.id === streamId,
                );
                if (idx !== -1 && idx !== currentSlide) {
                    currentSlide = idx;
                    updateCarousel();
                }
                playVideo(info.streamUrl, info.title, info);
                return;
            }
            playVideo(
                fallbackUrl || DEFAULT_STREAM_FALLBACK,
                fallbackTitle || "Live Channel",
            );
        }

        function populateModalInfo(meta = {}) {
            const wrapper = document.getElementById("modalSide");
            const titleEl = document.getElementById("modalInfoTitle");
            const descEl = document.getElementById("modalInfoDesc");
            const qualityEl = document.getElementById("modalInfoQuality");
            const genreEl = document.getElementById("modalInfoGenre");
            if (wrapper && meta?.id) {
                wrapper.dataset.streamId = meta.id;
            } else if (wrapper) {
                delete wrapper.dataset.streamId;
            }
            if (titleEl)
                titleEl.textContent = meta?.title || "Live Channel";
            if (descEl)
                descEl.textContent =
                    meta?.description ||
                    "Stream inayopatikana kwa sekunde chache zijazo.";
            if (qualityEl) qualityEl.textContent = meta?.quality || "Auto";
            if (genreEl) genreEl.textContent = meta?.genre || "General";
        }

        function addCurrentStreamToFavorites() {
            const wrapper = document.getElementById("modalSide");
            if (
                wrapper?.dataset.streamId &&
                streamLookup[wrapper.dataset.streamId]
            ) {
                toggleFavorite(streamLookup[wrapper.dataset.streamId].id);
                return;
            }
            const title =
                document.getElementById("modalInfoTitle")?.textContent;
            if (title) addToFavorites(title);
        }

        function hydrateStreamLookup() {
            Object.keys(streamLookup).forEach(
                (key) => delete streamLookup[key],
            );
            Object.values(categoryData || {}).forEach((category) => {
                (category.items || []).forEach((item) => {
                    streamLookup[item.id] = item;
                });
            });
        }

        function getFallbackArtwork(title = "") {
            const keyword = title?.split(" ")[0] || "stream";
            return `https://source.unsplash.com/1200x675/?${encodeURIComponent(keyword)}`;
        }

        function enhanceFeaturedStreams(streams = []) {
            return streams.map((stream) => {
                const reference = streamLookup[stream.id] || {};
                return {
                    ...reference,
                    ...stream,
                    thumbnail:
                        stream.thumbnail ||
                        reference.thumbnail ||
                        getFallbackArtwork(stream.title),
                };
            });
        }

        function ensureHeroData() {
            if (!liveStreams.length) {
                const fallback = Object.values(streamLookup).slice(0, 5);
                if (fallback.length) {
                    liveStreams = fallback;
                }
            }
        }

        function renderHeroStrip() {
            const strip = document.getElementById("heroStrip");
            if (!strip) return;
            strip.innerHTML = liveStreams
                .map(
                    (item, index) => `
                <button type="button" class="hero-thumb ${index === currentSlide ? "active" : ""}" data-index="${index}">
                    <img src="${item.thumbnail || getFallbackArtwork(item.title)}" alt="${item.title}">
                    <span>${item.title}</span>
                </button>
            `,
                )
                .join("");
            strip.querySelectorAll(".hero-thumb").forEach((btn) => {
                btn.addEventListener("click", () => {
                    const index = Number(btn.dataset.index);
                    goToSlide(index);
                });
            });
        }

        function renderHeroGallery() {
            const gallery = document.getElementById("heroGallery");
            if (!gallery) return;
            const featured = liveStreams.slice(0, 3);
            if (!featured.length) {
                gallery.innerHTML =
                    '<div class="gallery-card glass-panel">Hakuna chaneli zilizopangwa.</div>';
                return;
            }
            gallery.innerHTML = featured
                .map(
                    (item, index) => `
                <div class="gallery-card glass-panel ${index === 0 ? "active" : ""}" data-stream-id="${item.id}" onclick="playStream(${item.id})">
                    <span class="floating-pill">${item.genre || "Live"}</span>
                    <strong>${item.title}</strong>
                    <small>${item.description || "Moja kwa moja"}</small>
                </div>
            `,
                )
                .join("");
            if (featured.length) {
                const activeId =
                    liveStreams[currentSlide]?.id || featured[0].id;
                highlightHeroGallery(activeId);
            }
        }

        function highlightHeroGallery(activeId) {
            const galleryCards = document.querySelectorAll(
                "#heroGallery .gallery-card",
            );
            galleryCards.forEach((card) => {
                const id = Number(card.dataset.streamId);
                card.classList.toggle("active", id === activeId);
            });
        }

        function renderHeroProgress() {
            const progress = document.getElementById("heroProgress");
            if (!progress) return;
            progress.innerHTML = liveStreams
                .map(
                    (_, index) => `
                <span class="hero-progress-dot ${index === currentSlide ? "active" : ""}"></span>
            `,
                )
                .join("");
        }

        function highlightHeroStrip() {
            const strip = document.getElementById("heroStrip");
            if (!strip) return;
            strip
                .querySelectorAll(".hero-thumb")
                .forEach((thumb, index) => {
                    thumb.classList.toggle(
                        "active",
                        index === currentSlide,
                    );
                });
        }

        function updateHeroStats() {
            const stats = {
                statLive: liveStreams.length,
                statCategories: Object.values(categoryData || {}).filter(
                    (cat) => (cat.items || []).length,
                ).length,
                statFavorites: favorites.length,
            };
            Object.entries(stats).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = value.toString().padStart(2, "0");
                }
            });
        }

        function initializeHeroCarousel() {
            if (!liveStreams.length) return;
            renderHeroStrip();
            renderHeroProgress();
            renderHeroGallery();
            updateCarousel();
        }

        function setupModernPlayer() {
            const video = document.getElementById("modalVideo");
            if (!video) return;

            const volumeRange = document.getElementById("volumeRange");
            const speedSelect = document.getElementById("speedSelect");

            if (volumeRange) {
                volumeRange.value = video.volume;
                video.addEventListener("volumechange", () => {
                    volumeRange.value = video.volume.toFixed(2);
                });
            }

            if (speedSelect) {
                speedSelect.value = "1";
                video.addEventListener("ratechange", () => {
                    speedSelect.value = String(video.playbackRate);
                });
            }

            video.addEventListener("waiting", () =>
                showPlayerStatus("Ina-buffer...", "fa-spinner", true),
            );
            video.addEventListener("playing", () => hidePlayerStatus(800));
            video.addEventListener("seeking", () =>
                showPlayerStatus("Inasaka sekunde...", "fa-forward"),
            );
            video.addEventListener("stalled", () =>
                showPlayerStatus(
                    "Signal imekwama, inajaribu tena...",
                    "fa-redo",
                ),
            );
            video.addEventListener("error", () =>
                handleVideoElementError(),
            );
        }

        function showPlayerStatus(
            message,
            icon = "fa-satellite-dish",
            pulse = false,
        ) {
            const statusEl = document.getElementById("playerStatus");
            if (!statusEl) return;
            const iconEl = statusEl.querySelector("i");
            const textEl = statusEl.querySelector("span");
            if (iconEl) {
                iconEl.className = `fas ${icon}`;
                iconEl.style.animation = pulse
                    ? "spin 1s linear infinite"
                    : "none";
            }
            if (textEl) textEl.textContent = message;
            statusEl.classList.add("active");
            if (playerStatusTimeout) clearTimeout(playerStatusTimeout);
        }

        function hidePlayerStatus(delay = 0) {
            const statusEl = document.getElementById("playerStatus");
            if (!statusEl) return;
            if (playerStatusTimeout) clearTimeout(playerStatusTimeout);
            playerStatusTimeout = setTimeout(() => {
                statusEl.classList.remove("active");
            }, delay);
        }

        function destroyHlsPlayer() {
            if (hlsPlayer) {
                hlsPlayer.destroy();
                hlsPlayer = null;
            }
        }

        function resetModernPlayer(videoEl) {
            if (!videoEl) return;
            destroyHlsPlayer();
            videoEl.pause();
            videoEl.removeAttribute("src");
            delete videoEl.dataset.streamUrl;
            delete videoEl.dataset.usingFallback;
            const modalSource = document.getElementById("modalSource");
            if (modalSource) {
                modalSource.src = "";
                modalSource.removeAttribute("type");
            }
            videoEl.load();
        }

        function attachStreamToVideo(
            url,
            { resetRetries = false, onReady } = {},
        ) {
            const video = document.getElementById("modalVideo");
            const modalSource = document.getElementById("modalSource");
            if (!video) return;

            if (resetRetries) {
                playerRetryCount = 0;
            }

            const isM3u8 = /\.m3u8(\?|$)/i.test(url);
            const isAudio = /\.(mp3|aac|m4a|ogg|wav)$/i.test(url);
            destroyHlsPlayer();
            showPlayerStatus("Inajiandaa kuunganisha stream...");

            if (isM3u8 && window.Hls && window.Hls.isSupported()) {
                hlsPlayer = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90,
                    maxBufferSize: 60 * 1000 * 1000,
                    manifestLoadingTimeOut: 20000,
                    capLevelToPlayerSize: true,
                    maxBufferHole: 0.5,
                });

                hlsPlayer.on(Hls.Events.MANIFEST_PARSED, () => {
                    showPlayerStatus(
                        "Signal imeunganishwa ",
                        "fa-broadcast-tower",
                    );
                    if (typeof onReady === "function") onReady();
                });

                hlsPlayer.on(Hls.Events.ERROR, (event, data) =>
                    handleHlsError(url, data),
                );

                try {
                    hlsPlayer.loadSource(url);
                    hlsPlayer.attachMedia(video);
                } catch (error) {
                    console.error("HLS init failed", error);
                    handleVideoElementError();
                }

                if (modalSource) {
                    modalSource.src = "";
                    modalSource.removeAttribute("type");
                }
                return;
            }

            // Native HLS (Safari) or MP4 fallback
            if (modalSource) {
                modalSource.src = url;
                modalSource.type = isM3u8
                    ? "application/x-mpegURL"
                    : isAudio
                        ? "audio/mpeg"
                        : "video/mp4";
            }
            video.src = url;
            video.setAttribute(
                "poster",
                isAudio
                    ? "https://via.placeholder.com/800x450/050308/FFFFFF?text=Audio+Stream"
                    : "",
            );
            video.load();

            if (typeof onReady === "function") {
                const handleLoaded = () => {
                    video.removeEventListener("loadeddata", handleLoaded);
                    onReady();
                };
                video.addEventListener("loadeddata", handleLoaded);
            }
        }

        function handleHlsError(url, data) {
            if (!data) return;
            console.warn("HLS error", data);
            if (data.fatal) {
                if (playerRetryCount < MAX_PLAYER_RETRIES) {
                    playerRetryCount += 1;
                    showPlayerStatus(
                        "Signal imepotea, inajaribu tena...",
                        "fa-redo",
                    );
                    attachStreamToVideo(url, { resetRetries: false });
                    return;
                }
                showPlayerStatus(
                    "Stream imekataa kuunganishwa",
                    "fa-triangle-exclamation",
                );
                handleVideoElementError();
            }
        }

        function handleVideoElementError() {
            const modalVideo = document.getElementById("modalVideo");
            const usingFallback =
                modalVideo?.dataset.usingFallback === "true";
            if (modalVideo && !usingFallback) {
                modalVideo.dataset.usingFallback = "true";
                modalVideo.dataset.streamUrl = DEFAULT_STREAM_FALLBACK;
                showPlayerStatus(
                    "Signal imesimama, tunakupa sampuli...",
                    "fa-plug-circle-exclamation",
                );
                attachStreamToVideo(DEFAULT_STREAM_FALLBACK, {
                    resetRetries: true,
                    onReady: () =>
                        attemptAutoplay(modalVideo, lastPlaybackContext),
                });
                return;
            }
            hideLoading();
            showPlayerStatus(
                "Imeshindwa kuunganisha stream",
                "fa-triangle-exclamation",
            );
            notifyUser(
                "Hatukuweza kuunganisha stream. Tafadhali jaribu tena baadae.",
            );
        }

        function attemptAutoplay(video, { isMobile, autoplayAllowed }) {
            if (!video) return;
            if (!autoplayAllowed) {
                hideLoading();
                showPlayerStatus(
                    "Tayari kucheza - bonyeza Play",
                    "fa-hand-pointer",
                );
                return;
            }
            const playPromise = video.play();
            if (playPromise && typeof playPromise.then === "function") {
                playPromise
                    .then(() => {
                        hideLoading();
                        video.muted = false;
                        hidePlayerStatus(1200);
                    })
                    .catch((err) => {
                        console.warn("Autoplay blocked", err);
                        hideLoading();
                        showPlayerStatus(
                            "Bonyeza Play kuendelea",
                            "fa-hand-pointer",
                        );
                        if (!isMobile) {
                            notifyUser(
                                "Bonyeza kitufe cha Play kuanza video",
                            );
                        }
                    });
            } else {
                hideLoading();
            }
        }

        // Video Functions
        function playVideo(url, title, meta = null) {
            showLoading();
            const modal = document.getElementById("modalOverlay");
            const modalVideo = document.getElementById("modalVideo");
            const modalTitle = document.getElementById("modalTitle");

            modalTitle.textContent = title;

            // Clear previous source
            resetModernPlayer(modalVideo);
            modalVideo.setAttribute("playsinline", "");
            modalVideo.setAttribute("webkit-playsinline", "");
            modalVideo.setAttribute("x5-playsinline", "");
            modalVideo.setAttribute("x5-video-player-type", "h5");
            modalVideo.setAttribute("x5-video-player-fullscreen", "true");
            modalVideo.setAttribute("crossorigin", "anonymous");
            const sanitizedUrl = url || DEFAULT_STREAM_FALLBACK;
            modalVideo.dataset.streamUrl = sanitizedUrl;
            modalVideo.dataset.usingFallback = "false";
            modal.classList.add("active");

            // Mobile-friendly playback
            const isMobile =
                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
                    navigator.userAgent,
                );
            const autoplayAllowed = !appPreferences.dataSaver && !isMobile;
            modalVideo.autoplay = autoplayAllowed;
            showPlayerStatus("Inajiandaa kucheza...");
            lastPlaybackContext = { isMobile, autoplayAllowed };

            if (appPreferences.dataSaver) {
                notifyUser("Data Saver: bonyeza Play kuanza video");
            } else if (isMobile) {
                notifyUser("Bonyeza Play kuanza stream kwenye simu");
            }

            populateModalInfo(
                meta ||
                Object.values(streamLookup).find(
                    (item) => item.title === title,
                ) || { title },
            );

            attachStreamToVideo(sanitizedUrl, {
                resetRetries: true,
                onReady: () =>
                    attemptAutoplay(modalVideo, {
                        isMobile,
                        autoplayAllowed,
                    }),
            });
        }

        function changePlaybackSpeed(speed) {
            const video = document.getElementById("modalVideo");
            if (video) video.playbackRate = parseFloat(speed);
        }

        function changeVolume(value) {
            const video = document.getElementById("modalVideo");
            if (video) {
                const vol = Math.min(1, Math.max(0, parseFloat(value)));
                video.volume = vol;
            }
        }

        function toggleFullscreen() {
            const modalContent = document.querySelector(".modal-content");
            if (!modalContent) return;

            if (!document.fullscreenElement) {
                if (modalContent.requestFullscreen) {
                    modalContent.requestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function closeModal() {
            const modal = document.getElementById("modalOverlay");
            const modalVideo = document.getElementById("modalVideo");
            if (modal) modal.classList.remove("active");
            if (modalVideo) {
                destroyHlsPlayer();
                modalVideo.pause();
                modalVideo.currentTime = 0;
            }
            hidePlayerStatus();
        }

        // Search Functions
        function handleSearch(e) {
            clearTimeout(searchTimeout);
            const query = e.target.value.toLowerCase().trim();

            searchTimeout = setTimeout(() => {
                if (query.length < 2) {
                    document
                        .getElementById("searchResults")
                        .classList.remove("active");
                    document.getElementById("mainCarousel").style.display =
                        "block";
                    document.getElementById(
                        "categorySection",
                    ).style.display = "block";
                    return;
                }

                const results = [];
                Object.values(categoryData).forEach((category) => {
                    category.items.forEach((item) => {
                        if (item.title.toLowerCase().includes(query)) {
                            results.push(item);
                        }
                    });
                });

                displaySearchResults(results, query);
            }, 300);
        }

        function displaySearchResults(results, query) {
            const searchResults = document.getElementById("searchResults");
            const searchGrid = document.getElementById("searchGrid");

            if (results.length === 0) {
                searchGrid.innerHTML = `<p style="text-align: center; padding: 50px; color: rgba(255,255,255,0.5);">No results found for "${query}"</p>`;
            } else {
                renderContentGrid(results);
                searchGrid.innerHTML =
                    document.getElementById("contentGrid").innerHTML;
            }

            document.getElementById("mainCarousel").style.display = "none";
            document.getElementById("categorySection").style.display =
                "none";
            searchResults.classList.add("active");
        }

        // Favorites Functions
        function toggleFavorite(itemId) {
            const index = favorites.indexOf(itemId);
            if (index > -1) {
                favorites.splice(index, 1);
                notifyUser("Umeondoa kipengele kwenye Favorites.");
            } else {
                favorites.push(itemId);
                notifyUser("Umeongeza kipengele kwenye Favorites.");
            }
            localStorage.setItem("favorites", JSON.stringify(favorites));
            updateFavoritesButton();
            updateHeroStats();

            // Re-render current view
            const data = categoryData[currentCategory];
            if (data) renderContentGrid(data.items);
        }

        function addToFavorites(title) {
            const allItems = [];
            Object.values(categoryData).forEach((cat) => {
                cat.items.forEach((item) => {
                    if (item.title === title) {
                        toggleFavorite(item.id);
                    }
                });
            });
        }

        function showFavorites() {
            const favoriteItems = [];
            Object.values(categoryData).forEach((category) => {
                category.items.forEach((item) => {
                    if (favorites.includes(item.id)) {
                        favoriteItems.push(item);
                    }
                });
            });

            if (favoriteItems.length === 0) {
                alert(
                    "No favorites yet! Add some by clicking the heart icon on any content.",
                );
                return;
            }

            document.getElementById("categoryTitle").textContent =
                "My Favorites";
            renderContentGrid(favoriteItems);
            document
                .getElementById("searchResults")
                .classList.remove("active");
            document.getElementById("mainCarousel").style.display = "block";
            document.getElementById("categorySection").style.display =
                "block";
        }

        function updateFavoritesButton() {
            const btn = document.getElementById("favoritesBtn");
            if (favorites.length > 0) {
                btn.classList.add("active");
                btn.title = `Favorites (${favorites.length})`;
            } else {
                btn.classList.remove("active");
                btn.title = "Favorites";
            }
        }

        // Utility Functions
        function showLoading() {
            document.getElementById("loading").classList.add("active");
        }

        function hideLoading() {
            document.getElementById("loading").classList.remove("active");
        }

        // Notifications Functions
        async function loadNotifications() {
            try {
                const res = await fetch("/api/notifications");
                if (!res.ok)
                    throw new Error("Failed to load notifications");
                notifications = await res.json();
                updateNotificationBadge();
                renderNotifications();
            } catch (err) {
                console.error("Failed to load notifications", err);
            }
        }

        function renderNotifications() {
            const body = document.getElementById("notificationsBody");
            if (!body) return;

            if (!notifications.length) {
                body.innerHTML =
                    '<div class="notifications-empty">Hakuna notifications mpya. Admin atakutumia ujumbe unapohitajika.</div>';
                return;
            }

            body.innerHTML = notifications
                .sort(
                    (a, b) => new Date(b.createdAt) - new Date(a.createdAt),
                )
                .map(
                    (n) => `
                    <div class="notification-item-user ${n.read ? "" : "unread"}" onclick="markNotificationRead(${n.id})">
                        <div class="notification-title-user">${n.title || ""}</div>
                        <div class="notification-message-user">${n.message || ""}</div>
                        <div class="notification-meta-user">
                            <span class="notification-type-badge ${n.type || "info"}">${n.type || "info"}</span>
                            <span>${new Date(n.createdAt).toLocaleString("sw-TZ")}</span>
                        </div>
                    </div>
                `,
                )
                .join("");
        }

        function updateNotificationBadge() {
            const badge = document.getElementById("notificationBadge");
            const unreadCount = notifications.filter((n) => !n.read).length;
            if (badge) {
                if (unreadCount > 0) {
                    badge.textContent =
                        unreadCount > 99 ? "99+" : unreadCount;
                    badge.style.display = "flex";
                } else {
                    badge.style.display = "none";
                }
            }
        }

        async function markNotificationRead(id) {
            try {
                await fetch(`/api/notifications/${id}/read`, {
                    method: "POST",
                });
                const notification = notifications.find((n) => n.id === id);
                if (notification) {
                    notification.read = true;
                    updateNotificationBadge();
                    renderNotifications();
                }
            } catch (err) {
                console.error("Failed to mark notification as read", err);
            }
        }

        function toggleNotificationsPanel() {
            const panel = document.getElementById("notificationsPanel");
            if (panel) {
                panel.classList.toggle("active");
                if (panel.classList.contains("active")) {
                    loadNotifications();
                }
            }
        }

        function closeNotificationsPanel() {
            const panel = document.getElementById("notificationsPanel");
            if (panel) {
                panel.classList.remove("active");
            }
        }

        function startNotificationPolling() {
            // Check for new notifications every 30 seconds
            notificationCheckInterval = setInterval(() => {
                loadNotifications();
            }, 30000);
        }

        // Close notifications panel when clicking outside
        document.addEventListener("click", (e) => {
            const panel = document.getElementById("notificationsPanel");
            const btn = document.getElementById("notificationsBtn");
            if (
                panel &&
                btn &&
                !panel.contains(e.target) &&
                !btn.contains(e.target)
            ) {
                closeNotificationsPanel();
            }
        });

        // Compact header menu toggle
        (function () {
            const menuToggle = document.getElementById('menuToggle');
            const compactMenu = document.getElementById('compactMenu');

            if (!menuToggle || !compactMenu) return;

            function closeMenu() {
                compactMenu.classList.remove('active');
                menuToggle.setAttribute('aria-expanded', 'false');
                compactMenu.setAttribute('aria-hidden', 'true');
            }

            function openMenu() {
                compactMenu.classList.add('active');
                menuToggle.setAttribute('aria-expanded', 'true');
                compactMenu.setAttribute('aria-hidden', 'false');
            }

            menuToggle.addEventListener('click', (ev) => {
                ev.stopPropagation();
                if (compactMenu.classList.contains('active')) closeMenu();
                else openMenu();
            });

            // Close when clicking outside
            document.addEventListener('click', (e) => {
                if (!compactMenu.contains(e.target) && !menuToggle.contains(e.target)) {
                    closeMenu();
                }
            });

            // Close on ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeMenu();
            });

            // Hide on resize
            window.addEventListener('resize', closeMenu);
        })();

        // Hide header controls when scrolling down; show when scrolling up
        (function () {
            const targets = [
                document.querySelector('.header'),
                document.querySelector('.search-container'),
                document.querySelector('.header-actions'),
                document.querySelector('.logo .logo-text'),
                document.querySelector('.logo-subtitle')
            ].filter(Boolean);

            if (!targets.length) return;

            let lastY = window.scrollY || 0;
            let ticking = false;

            function update() {
                const currentY = window.scrollY || 0;
                const delta = currentY - lastY;

                if (Math.abs(delta) < 8) {
                    ticking = false;
                    return;
                }

                if (currentY > lastY && currentY > 60) {
                    // Scrolling down
                    targets.forEach(el => el.classList.add('hidden-by-scroll'));
                } else {
                    // Scrolling up
                    targets.forEach(el => el.classList.remove('hidden-by-scroll'));
                }

                lastY = currentY;
                ticking = false;
            }

            window.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(update);
                    ticking = true;
                }
            }, { passive: true });
        })();
    </script>
</body>

</html>